# åŠ ä¸€ä¸ªæŒ‡å‘éšæœºèŠ‚ç‚¹çš„å•é“¾è¡¨ï¼ˆæ·±åº¦å¤åˆ¶ï¼‰

## é—®é¢˜æè¿°

ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹é™¤äº†æœ‰**nextæŒ‡é’ˆ**ï¼ˆæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼‰å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª**randomæŒ‡é’ˆ**ï¼ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»æ„èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬è‡ªå·±æˆ–nullï¼‰ã€‚

å®ç°**æ·±åº¦å¤åˆ¶**ï¼šåˆ›å»ºä¸€ä¸ªä¸åŸé“¾è¡¨å®Œå…¨ç›¸åŒçš„æ–°é“¾è¡¨ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„nextæŒ‡é’ˆå’ŒrandomæŒ‡é’ˆã€‚

### é“¾è¡¨èŠ‚ç‚¹çš„ç»“æ„

```typescript
class Node {
  val: number;
  next: Node | null;
  random: Node | null;

  constructor(val: number, next: Node | null = null, random: Node | null = null) {
    this.val = val;
    this.next = next;
    this.random = random;
  }
}
```

### ä¾‹å­

```
åŸé“¾è¡¨ï¼š
èŠ‚ç‚¹1(val=1) â†’ èŠ‚ç‚¹2(val=2) â†’ èŠ‚ç‚¹3(val=3)
  â†“ random         â†“ random        â†“ random
  èŠ‚ç‚¹3           èŠ‚ç‚¹1           èŠ‚ç‚¹2

è¦æ±‚å¤åˆ¶å‡ºï¼š
æ–°èŠ‚ç‚¹1(val=1) â†’ æ–°èŠ‚ç‚¹2(val=2) â†’ æ–°èŠ‚ç‚¹3(val=3)
  â†“ random         â†“ random        â†“ random
  æ–°èŠ‚ç‚¹3         æ–°èŠ‚ç‚¹1         æ–°èŠ‚ç‚¹2
```

**å…³é”®ç‚¹ï¼š**
- å¤åˆ¶çš„æ˜¯**æ–°çš„èŠ‚ç‚¹å¯¹è±¡**ï¼Œä¸æ˜¯åŸèŠ‚ç‚¹
- æ–°é“¾è¡¨çš„ç»“æ„å’ŒæŒ‡å‘å…³ç³»å¿…é¡»ä¸åŸé“¾è¡¨å®Œå…¨ç›¸åŒ
- ä¸èƒ½ä¿®æ”¹åŸé“¾è¡¨

---

## è§£é¢˜æ€è·¯

### æ–¹æ¡ˆ1ï¸âƒ£ï¼šå“ˆå¸Œè¡¨æ³•ï¼ˆæ¨èï¼‰â­

**æ€è·¯ï¼š**
1. ç¬¬ä¸€ééå†ï¼šåˆ›å»ºæ‰€æœ‰æ–°èŠ‚ç‚¹ï¼Œç”¨å“ˆå¸Œè¡¨è®°å½•"åŸèŠ‚ç‚¹â†’æ–°èŠ‚ç‚¹"çš„æ˜ å°„
2. ç¬¬äºŒééå†ï¼šæ ¹æ®æ˜ å°„ï¼Œå¤åˆ¶nextå’ŒrandomæŒ‡é’ˆ

**æ—¶é—´å¤æ‚åº¦ï¼š** O(n)
**ç©ºé—´å¤æ‚åº¦ï¼š** O(n)

```typescript
/**
 * å“ˆå¸Œè¡¨æ³•ï¼šç”¨Mapè®°å½•åŸèŠ‚ç‚¹åˆ°æ–°èŠ‚ç‚¹çš„æ˜ å°„
 */
function copyRandomList(head: Node | null): Node | null {
  if (!head) return null;

  // ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ˜ å°„è¡¨
  const map = new Map<Node, Node>();

  // éå†åŸé“¾è¡¨ï¼Œåˆ›å»ºæ‰€æœ‰æ–°èŠ‚ç‚¹
  let curr = head;
  while (curr) {
    map.set(curr, new Node(curr.val));  // â† è®°å½•æ˜ å°„å…³ç³»
    curr = curr.next;
  }

  // ç¬¬äºŒæ­¥ï¼šå¤åˆ¶æŒ‡é’ˆå…³ç³»
  curr = head;
  while (curr) {
    const newNode = map.get(curr)!;  // â† è·å–å¯¹åº”çš„æ–°èŠ‚ç‚¹

    // â† å¤åˆ¶nextæŒ‡é’ˆ
    if (curr.next) {
      newNode.next = map.get(curr.next)!;
    }

    // â† å¤åˆ¶randomæŒ‡é’ˆ
    if (curr.random) {
      newNode.random = map.get(curr.random)!;
    }

    curr = curr.next;
  }

  return map.get(head)!;  // â† è¿”å›æ–°é“¾è¡¨çš„å¤´èŠ‚ç‚¹
}
```

---

### æ–¹æ¡ˆ2ï¸âƒ£ï¼šåŸåœ°æ³•ï¼ˆç©ºé—´æ›´ä¼˜ï¼‰

**æ€è·¯ï¼š**
1. åœ¨æ¯ä¸ªåŸèŠ‚ç‚¹åé¢æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼ˆå…ˆnextï¼Œå†randomï¼‰
2. åˆ†ç¦»æ–°æ—§é“¾è¡¨

**æ—¶é—´å¤æ‚åº¦ï¼š** O(n)
**ç©ºé—´å¤æ‚åº¦ï¼š** O(1)ï¼ˆä¸ç®—è¿”å›å€¼ï¼‰

```typescript
/**
 * åŸåœ°æ³•ï¼šåœ¨åŸé“¾è¡¨ä¸Šè¿›è¡Œæ“ä½œï¼Œæœ€ååˆ†ç¦»
 */
function copyRandomListInPlace(head: Node | null): Node | null {
  if (!head) return null;

  // ç¬¬ä¸€æ­¥ï¼šåœ¨æ¯ä¸ªåŸèŠ‚ç‚¹åé¢æ’å…¥æ–°èŠ‚ç‚¹
  let curr = head;
  while (curr) {
    const newNode = new Node(curr.val);
    newNode.next = curr.next;
    curr.next = newNode;
    curr = newNode.next;  // â† è·³è¿‡æ–°èŠ‚ç‚¹ï¼Œç»§ç»­éå†åŸèŠ‚ç‚¹
  }

  // ç¬¬äºŒæ­¥ï¼šå¤åˆ¶randomæŒ‡é’ˆ
  curr = head;
  while (curr) {
    const newNode = curr.next!;

    if (curr.random) {
      newNode.random = curr.random.next;  // â† åŸèŠ‚ç‚¹çš„randomçš„nextå°±æ˜¯æ–°èŠ‚ç‚¹
    }

    curr = newNode.next;  // â† ç§»åˆ°ä¸‹ä¸€ä¸ªåŸèŠ‚ç‚¹
  }

  // ç¬¬ä¸‰æ­¥ï¼šåˆ†ç¦»æ–°æ—§é“¾è¡¨
  curr = head;
  const newHead = head.next;
  let newCurr = newHead;

  while (curr) {
    curr.next = newCurr.next;      // â† æ¢å¤åŸé“¾è¡¨
    curr = curr.next;

    if (newCurr.next) {
      newCurr.next = newCurr.next.next;  // â† åˆ†ç¦»æ–°é“¾è¡¨
    }

    newCurr = newCurr.next;
  }

  return newHead;
}
```

---

## ğŸ§  æ·±åº¦ç†è§£ä¸è®°å¿†

### ä¸ºä»€ä¹ˆè¿™é“é¢˜éš¾ï¼Ÿ

**é—®é¢˜ï¼š**
- æ™®é€šçš„æ·±åº¦å¤åˆ¶åªéœ€å¤åˆ¶nextæŒ‡é’ˆ
- ä½†è¿™é‡Œè¿˜æœ‰randomæŒ‡é’ˆï¼Œå¯ä»¥æŒ‡å‘ä»»æ„èŠ‚ç‚¹

**éš¾ç‚¹ï¼š**
```
å¦‚æœè¾¹åˆ›å»ºè¾¹å¤åˆ¶randomï¼š
  å½“ä½ åˆ›å»ºèŠ‚ç‚¹2æ—¶ï¼Œå®ƒçš„randomå¯èƒ½æŒ‡å‘èŠ‚ç‚¹5
  ä½†èŠ‚ç‚¹5è¿˜æ²¡åˆ›å»ºï¼ä½ æ€ä¹ˆçŸ¥é“è¦æŒ‡å‘å“ªé‡Œï¼Ÿ

æ‰€ä»¥éœ€è¦ï¼š
  1. å…ˆåˆ›å»ºæ‰€æœ‰èŠ‚ç‚¹
  2. å†å¤åˆ¶æŒ‡é’ˆå…³ç³»
```

### å“ˆå¸Œè¡¨æ³•çš„è¯¦ç»†è¿‡ç¨‹

**ä¾‹å­ï¼šé“¾è¡¨ 1 â†’ 2 â†’ 3ï¼Œå…¶ä¸­1.random=3ï¼Œ2.random=1ï¼Œ3.random=2**

```
ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ˜ å°„
map = {
  åŸèŠ‚ç‚¹1 â†’ æ–°èŠ‚ç‚¹1,
  åŸèŠ‚ç‚¹2 â†’ æ–°èŠ‚ç‚¹2,
  åŸèŠ‚ç‚¹3 â†’ æ–°èŠ‚ç‚¹3
}

æ­¤æ—¶æ–°èŠ‚ç‚¹ä¹‹é—´è¿˜æ²¡æœ‰ä»»ä½•è¿æ¥

ç¬¬äºŒæ­¥ï¼šå¤åˆ¶æŒ‡é’ˆå…³ç³»
å¤„ç†åŸèŠ‚ç‚¹1ï¼š
  æ–°èŠ‚ç‚¹1.next = map.get(åŸèŠ‚ç‚¹1.next) = æ–°èŠ‚ç‚¹2
  æ–°èŠ‚ç‚¹1.random = map.get(åŸèŠ‚ç‚¹1.random) = æ–°èŠ‚ç‚¹3

å¤„ç†åŸèŠ‚ç‚¹2ï¼š
  æ–°èŠ‚ç‚¹2.next = æ–°èŠ‚ç‚¹3
  æ–°èŠ‚ç‚¹2.random = æ–°èŠ‚ç‚¹1

å¤„ç†åŸèŠ‚ç‚¹3ï¼š
  æ–°èŠ‚ç‚¹3.next = nullï¼ˆåŸèŠ‚ç‚¹3.nextæ˜¯nullï¼‰
  æ–°èŠ‚ç‚¹3.random = æ–°èŠ‚ç‚¹2

å®Œæˆï¼æ–°é“¾è¡¨ç»“æ„ä¸åŸé“¾è¡¨ç›¸åŒ
```

### åŸåœ°æ³•çš„è¯¦ç»†è¿‡ç¨‹

**ç¬¬ä¸€æ­¥ï¼šæ’å…¥æ–°èŠ‚ç‚¹**

```
åŸå§‹ï¼š1 â†’ 2 â†’ 3

æ’å…¥åï¼š1 â†’ 1' â†’ 2 â†’ 2' â†’ 3 â†’ 3'
        â†‘å¥‡æ•°ä½ç½®æ˜¯åŸ   â†‘å¶æ•°ä½ç½®æ˜¯æ–°
```

**ç¬¬äºŒæ­¥ï¼šå¤åˆ¶random**

```
å› ä¸º åŸèŠ‚ç‚¹1.random = èŠ‚ç‚¹3
æ‰€ä»¥ æ–°èŠ‚ç‚¹1'.random = èŠ‚ç‚¹3.next = èŠ‚ç‚¹3'

å› ä¸ºåŸèŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹æ˜¯ç›¸é‚»çš„ï¼š
  æ–°èŠ‚ç‚¹ = åŸèŠ‚ç‚¹.next
  æ–°èŠ‚ç‚¹.random = åŸèŠ‚ç‚¹.random.next
```

**ç¬¬ä¸‰æ­¥ï¼šåˆ†ç¦»**

```
åŸå§‹æ··åˆï¼š1 â†’ 1' â†’ 2 â†’ 2' â†’ 3 â†’ 3'

åˆ†ç¦»åï¼š
  åŸé“¾è¡¨ï¼š1 â†’ 2 â†’ 3
  æ–°é“¾è¡¨ï¼š1' â†’ 2' â†’ 3'
```

---

## ä¸¤ç§æ–¹æ³•å¯¹æ¯”

| ç‰¹æ€§ | å“ˆå¸Œè¡¨æ³• | åŸåœ°æ³• |
|------|---------|--------|
| æ—¶é—´å¤æ‚åº¦ | O(n) | O(n) |
| ç©ºé—´å¤æ‚åº¦ | O(n) | O(1) |
| ä»£ç å¤æ‚åº¦ | ç®€å• | è¾ƒå¤æ‚ |
| ä¿®æ”¹åŸé“¾è¡¨ | å¦ âœ“ | æ˜¯ï¼ˆæš‚æ—¶ï¼Œæœ€åæ¢å¤ï¼‰ |
| æ¨èç¨‹åº¦ | â­â­â­â­â­ | â­â­â­ |

---

## è®°å¿†æŠ€å·§

### å“ˆå¸Œè¡¨æ³•çš„ä¸‰å¥è¯

```
1ï¸âƒ£  ç¬¬ä¸€éï¼šåˆ›å»ºæ‰€æœ‰æ–°èŠ‚ç‚¹ï¼Œç”¨Mapè®°å½•æ˜ å°„
2ï¸âƒ£  ç¬¬äºŒéï¼šéå†åŸé“¾è¡¨ï¼Œæ ¹æ®æ˜ å°„å¤åˆ¶æŒ‡é’ˆ
3ï¸âƒ£  è¿”å›æ–°é“¾è¡¨å¤´èŠ‚ç‚¹
```

### åŸåœ°æ³•çš„ä¸‰å¥è¯

```
1ï¸âƒ£  æ’å…¥ï¼šåœ¨æ¯ä¸ªåŸèŠ‚ç‚¹åæ’å…¥æ–°èŠ‚ç‚¹
2ï¸âƒ£  å¤åˆ¶ï¼šåˆ©ç”¨ç›¸é‚»å…³ç³»å¤åˆ¶randomæŒ‡é’ˆ
3ï¸âƒ£  åˆ†ç¦»ï¼šæ‹†åˆ†æˆä¸¤ä¸ªé“¾è¡¨
```

---

## ä»£ç æ¡†æ¶é€Ÿè®°

```typescript
// å“ˆå¸Œè¡¨æ³•æ¡†æ¶
function copyRandomList(head) {
  if (!head) return null;

  const map = new Map();

  // ç¬¬ä¸€éï¼šåˆ›å»ºæ˜ å°„
  let curr = head;
  while (curr) {
    map.set(curr, new Node(curr.val));
    curr = curr.next;
  }

  // ç¬¬äºŒéï¼šå¤åˆ¶æŒ‡é’ˆ
  curr = head;
  while (curr) {
    const newNode = map.get(curr);
    if (curr.next) newNode.next = map.get(curr.next);
    if (curr.random) newNode.random = map.get(curr.random);
    curr = curr.next;
  }

  return map.get(head);
}
```

---

## å¸¸è§é”™è¯¯ä¸é¿å‘

```typescript
// âŒ é”™è¯¯1ï¼šè¾¹åˆ›å»ºè¾¹å¤åˆ¶
const newNode = new Node(curr.val);
newNode.random = curr.random;  // â† é”™ï¼curr.randomè¿˜æ²¡å¤åˆ¶
newNode.next = curr.next;

// âœ… æ­£ç¡®ï¼šå…ˆåˆ›å»ºæ‰€æœ‰ï¼Œå†å¤åˆ¶å…³ç³»

// âŒ é”™è¯¯2ï¼šæ²¡æœ‰æ£€æŸ¥null
newNode.random = map.get(curr.random)!;  // å¦‚æœcurr.randomæ˜¯nullä¼šå‡ºé”™

// âœ… æ­£ç¡®ï¼šæ£€æŸ¥åå†èµ‹å€¼
if (curr.random) {
  newNode.random = map.get(curr.random)!;
}

// âŒ é”™è¯¯3ï¼šåŸåœ°æ³•ä¸­æ²¡æœ‰æ­£ç¡®æ¢å¤åŸé“¾è¡¨
// å¦‚æœä»»åŠ¡æ˜ç¡®è¯´"ä¸èƒ½ä¿®æ”¹åŸé“¾è¡¨"ï¼Œç”¨å“ˆå¸Œè¡¨æ³•æ›´å®‰å…¨

// âœ… æ­£ç¡®ï¼šæˆ–è€…ä»”ç»†å®ç°åŸåœ°æ³•å¹¶å®Œå…¨æ¢å¤
```

---

## å»¶ä¼¸æ€è€ƒ

### Q1: å¦‚ä½•æ£€éªŒå¤åˆ¶æ˜¯å¦æ­£ç¡®ï¼Ÿ

```typescript
function isDeepCopyCorrect(original, copy) {
  let o = original;
  let c = copy;

  while (o && c) {
    // æ£€æŸ¥å€¼ç›¸ç­‰
    if (o.val !== c.val) return false;

    // æ£€æŸ¥nextæŒ‡å‘çš„å€¼ç›¸ç­‰
    if ((o.next?.val || null) !== (c.next?.val || null)) return false;

    // æ£€æŸ¥randomæŒ‡å‘çš„å€¼ç›¸ç­‰
    if ((o.random?.val || null) !== (c.random?.val || null)) return false;

    // æ£€æŸ¥ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼ˆæ˜¯æ·±æ‹·è´ï¼‰
    if (o === c) return false;

    o = o.next;
    c = c.next;
  }

  return !o && !c;  // éƒ½åˆ°äº†æœ«å°¾
}
```

### Q2: ä¸ºä»€ä¹ˆåŸåœ°æ³•çš„ç©ºé—´å¤æ‚åº¦æ˜¯O(1)ï¼Ÿ

```
è™½ç„¶åˆ›å»ºäº†nä¸ªæ–°èŠ‚ç‚¹ï¼Œä½†é¢˜ç›®è¦æ±‚è¿”å›æ–°é“¾è¡¨
æ‰€ä»¥æ–°èŠ‚ç‚¹å¿…é¡»å­˜åœ¨ï¼Œä¸ç®—é¢å¤–ç©ºé—´

åªæ˜¯åˆ©ç”¨äº†åŸé“¾è¡¨çš„ç»“æ„æ¥å­˜å‚¨ä¸´æ—¶ä¿¡æ¯
æœ€åå®Œå…¨æ¢å¤ï¼Œä¸ç•™ç—•è¿¹
```

### Q3: å¦‚æœé“¾è¡¨å¾ˆå¤§ï¼Œå“ªç§æ–¹æ³•æ›´å¥½ï¼Ÿ

```
å“ˆå¸Œè¡¨æ³•ï¼š
  ä¼˜ç‚¹ï¼šä»£ç ç®€å•ï¼Œä¸ä¿®æ”¹åŸé“¾è¡¨
  ç¼ºç‚¹ï¼šéœ€è¦O(n)é¢å¤–ç©ºé—´

åŸåœ°æ³•ï¼š
  ä¼˜ç‚¹ï¼šç©ºé—´ä¼˜åŒ–åˆ°O(1)
  ç¼ºç‚¹ï¼šä»£ç å¤æ‚ï¼Œæš‚æ—¶ä¿®æ”¹åŸé“¾è¡¨

ç»“è®ºï¼šä¸€èˆ¬ç”¨å“ˆå¸Œè¡¨æ³•ï¼ˆæ›´å®‰å…¨æ›´æ¸…æ™°ï¼‰
     é™¤éæ˜ç¡®è¦æ±‚ç©ºé—´ä¼˜åŒ–
```
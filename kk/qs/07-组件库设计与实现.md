# 组件库设计与实现详解

## 考点概述
组件库是前端工程化的基础，是实现代码复用、提升开发效率的关键。设计一个好的组件库需要深入理解组件的本质、架构和最佳实践。

---

## 核心概念

### 1. 什么是组件库

**通俗解释：**
```
组件库就像积木工厂：
├─ 制造各种规格的积木（Button、Input、Select等）
├─ 确保每块积木质量稳定
├─ 提供使用说明（文档）
├─ 支持自由组合（组合成复杂UI）
└─ 减少重复工作（无需重复制造积木）
```

**组件库的本质：**
```
可复用的UI代码 + 详细文档 + 规范的API + 完整的测试
```

**组件库与UI库的区别：**
```
UI库 (如Ant Design、Element Plus)
├─ 目标：通用的UI组件
├─ 特点：高度通用，适应广泛场景
├─ 使用者：所有项目都能用
└─ 维护成本：社区维护

组件库 (企业内部)
├─ 目标：特定业务的组件
├─ 特点：针对性强，高度定制
├─ 使用者：特定项目团队
└─ 维护成本：团队维护
```

---

### 2. 组件库的分类

**按功能分类：**
```
基础组件库
├─ 按钮、输入框、下拉框等
├─ 最基础的UI元素
└─ 所有应用都需要

业务组件库
├─ 用户选择器、部门树、日期范围等
├─ 针对特定业务需求
└─ 特定领域使用

布局组件库
├─ 栅格系统、容器、Flex等
├─ 控制页面布局
└─ 提高布局效率

图表/数据展示组件库
├─ 图表、表格、统计卡片等
├─ 展示数据
└─ 数据可视化

工具组件库
├─ 弹窗、通知、加载动画等
├─ 交互功能
└─ 增强用户体验
```

**按技术栈分类：**
```
Vue组件库
├─ Vue 2: Element Plus, Vant等
└─ Vue 3: Ant Design Vue, PrimeVue等

React组件库
├─ Ant Design, Material UI, shadcn/ui等
└─ 最成熟的生态

Angular组件库
├─ Angular Material, Clarity等
└─ 企业级应用

原生组件库
├─ Web Components标准
├─ Lit, Shoelace等
└─ 框架无关
```

---

## 组件库架构

### 3. 典型的组件库结构

**文件夹组织：**
```
my-component-library/
├─ packages/
│  ├─ vue/
│  │  ├─ src/
│  │  │  ├─ components/
│  │  │  │  ├─ Button/
│  │  │  │  │  ├─ Button.vue (组件)
│  │  │  │  │  ├─ Button.test.ts (单元测试)
│  │  │  │  │  ├─ Button.story.ts (Storybook)
│  │  │  │  │  ├─ README.md (文档)
│  │  │  │  │  └─ index.ts (导出)
│  │  │  │  ├─ Input/
│  │  │  │  ├─ Select/
│  │  │  │  └─ ...
│  │  │  ├─ composables/
│  │  │  │  ├─ useToggle.ts
│  │  │  │  ├─ useAsync.ts
│  │  │  │  └─ ...
│  │  │  ├─ utils/
│  │  │  ├─ styles/
│  │  │  │  ├─ variables.scss (设计tokens)
│  │  │  │  ├─ reset.scss
│  │  │  │  └─ ...
│  │  │  └─ index.ts (主入口)
│  │  ├─ package.json
│  │  └─ tsconfig.json
│  │
│  └─ react/ (React版本，结构类似)
│
├─ docs/
│  ├─ guide/ (快速开始)
│  ├─ components/ (组件文档)
│  └─ tokens/ (设计规范)
│
├─ storybook/ (组件预览和测试)
│
├─ scripts/
│  ├─ build.js (打包脚本)
│  ├─ publish.js (发布脚本)
│  └─ ...
│
├─ lerna.json (Monorepo配置)
├─ package.json
└─ README.md
```

**核心概念：Monorepo**
```
Monorepo = Multiple Repositories in One
├─ 一个Git仓库管理多个包（Vue版、React版、文档等）
├─ 使用Lerna或PNPM Workspaces管理
├─ 提高代码复用（共享工具、样式等）
├─ 简化发布流程（同时更新多个包）
└─ 示例：Ant Design, Element UI等都采用Monorepo
```

---

### 4. 设计令牌（Design Tokens）

**什么是设计令牌？**
```
设计令牌 = 设计规范的最小单位

颜色令牌
├─ primary: #1890ff
├─ success: #52c41a
├─ warning: #faad14
└─ danger: #f5222d

尺寸令牌
├─ xs: 4px
├─ sm: 8px
├─ md: 16px
├─ lg: 24px
└─ xl: 32px

排版令牌
├─ fontSize-base: 14px
├─ fontSize-lg: 16px
├─ lineHeight-normal: 1.5
└─ fontWeight-bold: 600

圆角令牌
├─ radius-sm: 2px
├─ radius-md: 4px
├─ radius-lg: 8px
└─ radius-round: 50%

阴影令牌
├─ shadow-sm: 0 1px 2px rgba(0,0,0,0.05)
├─ shadow-md: 0 4px 8px rgba(0,0,0,0.1)
└─ shadow-lg: 0 10px 20px rgba(0,0,0,0.15)
```

**设计令牌的实现方式：**
```typescript
// 方法1：CSS变量（推荐）
// src/styles/variables.css
:root {
  --color-primary: #1890ff;
  --color-success: #52c41a;
  --color-warning: #faad14;
  --color-danger: #f5222d;

  --size-xs: 4px;
  --size-sm: 8px;
  --size-md: 16px;

  --radius-sm: 2px;
  --radius-md: 4px;
  --radius-lg: 8px;

  --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
  --shadow-md: 0 4px 8px rgba(0,0,0,0.1);
}

// 使用
.button {
  background-color: var(--color-primary);
  padding: var(--size-md);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-sm);
}

// 优势：
// ✅ 可以动态切换主题
// ✅ 浏览器原生支持
// ✅ 实时生效无需编译

// 方法2：Sass变量
// src/styles/variables.scss
$color-primary: #1890ff;
$color-success: #52c41a;
$size-xs: 4px;
$size-md: 16px;

.button {
  background-color: $color-primary;
  padding: $size-md;
}

// 编译后成CSS

// 方法3：JavaScript对象
// src/tokens/index.ts
export const tokens = {
  colors: {
    primary: '#1890ff',
    success: '#52c41a',
    warning: '#faad14',
  },
  sizes: {
    xs: '4px',
    sm: '8px',
    md: '16px',
  }
}

// 在组件中使用
import { tokens } from '@/tokens'
const style = {
  backgroundColor: tokens.colors.primary,
  padding: tokens.sizes.md
}
```

---

## 组件设计

### 5. 如何设计一个好的组件

**组件的三要素：**
```
Props (输入)
├─ 组件接收的参数
├─ 决定组件的外观和行为
└─ 需要完整的类型定义

Slots (内容插槽)
├─ 允许父组件传入子元素
├─ 提供高度的灵活性
└─ 实现组件组合

Events (输出)
├─ 组件向父组件通信
├─ 用户交互的反馈
└─ 遵循命名规范
```

**Button 组件的完整设计：**
```vue
<template>
  <button
    :class="[
      'btn',
      `btn-${type}`,
      `btn-${size}`,
      {
        'btn-block': block,
        'btn-disabled': disabled || loading
      }
    ]"
    :disabled="disabled || loading"
    @click="handleClick"
  >
    <!-- 加载动画 -->
    <span v-if="loading" class="btn-loading">
      <i class="icon-spinner"></i>
    </span>

    <!-- 图标 -->
    <i v-if="icon && !loading" :class="['btn-icon', icon]"></i>

    <!-- 文本 -->
    <span class="btn-text">
      <slot></slot>
    </span>
  </button>
</template>

<script lang="ts">
import { defineComponent, PropType } from 'vue'

export default defineComponent({
  name: 'Button',
  props: {
    // 按钮类型
    type: {
      type: String as PropType<'primary' | 'default' | 'dashed' | 'text' | 'link'>,
      default: 'default'
    },

    // 按钮大小
    size: {
      type: String as PropType<'small' | 'middle' | 'large'>,
      default: 'middle'
    },

    // 是否禁用
    disabled: {
      type: Boolean,
      default: false
    },

    // 是否加载中
    loading: {
      type: Boolean,
      default: false
    },

    // 是否为块级元素（100%宽度）
    block: {
      type: Boolean,
      default: false
    },

    // 图标
    icon: {
      type: String,
      default: undefined
    },

    // 是否为危险操作（红色）
    danger: {
      type: Boolean,
      default: false
    },

    // HTML type属性
    htmlType: {
      type: String as PropType<'button' | 'submit' | 'reset'>,
      default: 'button'
    }
  },

  emits: ['click'],

  setup(props, { emit }) {
    const handleClick = (event: MouseEvent) => {
      if (props.disabled || props.loading) {
        return
      }

      emit('click', event)
    }

    return { handleClick }
  }
})
</script>

<style scoped lang="scss">
$border-radius: 4px;
$transition: all 0.3s ease;

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 6px 16px;
  font-size: 14px;
  border-radius: $border-radius;
  border: 1px solid transparent;
  cursor: pointer;
  transition: $transition;
  white-space: nowrap;

  // 禁用状态
  &.btn-disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  // 尺寸变体
  &.btn-small {
    padding: 4px 12px;
    font-size: 12px;
  }

  &.btn-large {
    padding: 8px 20px;
    font-size: 16px;
  }

  // 类型变体
  &.btn-primary {
    background-color: #1890ff;
    color: white;
    border-color: #1890ff;

    &:hover:not(.btn-disabled) {
      background-color: #40a9ff;
      border-color: #40a9ff;
    }
  }

  &.btn-default {
    background-color: white;
    color: rgba(0, 0, 0, 0.85);
    border-color: #d9d9d9;

    &:hover:not(.btn-disabled) {
      color: #40a9ff;
      border-color: #40a9ff;
    }
  }

  &.btn-dashed {
    background-color: white;
    border-style: dashed;
    border-color: #d9d9d9;
  }

  &.btn-text {
    background-color: transparent;
    border: none;
    color: #1890ff;

    &:hover:not(.btn-disabled) {
      background-color: rgba(24, 144, 255, 0.1);
    }
  }

  // 块级
  &.btn-block {
    width: 100%;
  }
}

.btn-icon {
  font-size: 14px;
}

.btn-loading {
  display: inline-flex;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}
</style>
```

**使用示例：**
```vue
<template>
  <!-- 基础 -->
  <Button>Click me</Button>

  <!-- 不同类型 -->
  <Button type="primary">Primary</Button>
  <Button type="dashed">Dashed</Button>
  <Button type="text">Text</Button>

  <!-- 不同大小 -->
  <Button size="small">Small</Button>
  <Button size="large">Large</Button>

  <!-- 加载状态 -->
  <Button :loading="isLoading" @click="handleClick">
    Submit
  </Button>

  <!-- 禁用 -->
  <Button disabled>Disabled</Button>

  <!-- 块级 -->
  <Button block>Full Width</Button>

  <!-- 带图标 -->
  <Button icon="icon-download">Download</Button>
</template>
```

---

### 6. Input 组件设计

```vue
<template>
  <div :class="['input-wrapper', { 'input-error': error }]">
    <!-- 标签 -->
    <label v-if="label" :for="inputId" class="input-label">
      {{ label }}
      <span v-if="required" class="input-required">*</span>
    </label>

    <!-- 输入框容器 -->
    <div class="input-container">
      <!-- 前缀 -->
      <span v-if="$slots.prefix" class="input-prefix">
        <slot name="prefix"></slot>
      </span>

      <!-- 输入框 -->
      <input
        :id="inputId"
        :type="type"
        :value="modelValue"
        :placeholder="placeholder"
        :disabled="disabled"
        :readonly="readonly"
        :required="required"
        :maxlength="maxlength"
        :class="['input', { 'input-disabled': disabled }]"
        @input="handleInput"
        @focus="handleFocus"
        @blur="handleBlur"
        @keydown="$emit('keydown', $event)"
      />

      <!-- 后缀 -->
      <span v-if="$slots.suffix" class="input-suffix">
        <slot name="suffix"></slot>
      </span>

      <!-- 清空按钮 -->
      <button
        v-if="clearable && modelValue"
        class="input-clear"
        @click="handleClear"
      >
        ✕
      </button>

      <!-- 密码切换 -->
      <button
        v-if="type === 'password' && showPasswordToggle"
        class="input-toggle-password"
        @click="togglePasswordVisibility"
      >
        {{ showPassword ? '隐藏' : '显示' }}
      </button>
    </div>

    <!-- 错误提示 -->
    <p v-if="error" class="input-error-message">
      {{ error }}
    </p>

    <!-- 帮助文本 -->
    <p v-if="help && !error" class="input-help">
      {{ help }}
    </p>

    <!-- 字符数统计 -->
    <p v-if="showCharCount && maxlength" class="input-char-count">
      {{ modelValue?.length || 0 }} / {{ maxlength }}
    </p>
  </div>
</template>

<script lang="ts">
import { defineComponent, PropType } from 'vue'
import { v4 as uuidv4 } from 'uuid'

export default defineComponent({
  name: 'Input',
  props: {
    // 双向绑定值
    modelValue: {
      type: String,
      default: ''
    },

    // 输入框类型
    type: {
      type: String as PropType<'text' | 'email' | 'password' | 'number' | 'tel' | 'url'>,
      default: 'text'
    },

    // 标签
    label: {
      type: String,
      default: undefined
    },

    // 占位符
    placeholder: {
      type: String,
      default: undefined
    },

    // 是否禁用
    disabled: {
      type: Boolean,
      default: false
    },

    // 是否只读
    readonly: {
      type: Boolean,
      default: false
    },

    // 是否必填
    required: {
      type: Boolean,
      default: false
    },

    // 最大长度
    maxlength: {
      type: Number,
      default: undefined
    },

    // 是否显示清空按钮
    clearable: {
      type: Boolean,
      default: false
    },

    // 是否显示密码切换
    showPasswordToggle: {
      type: Boolean,
      default: true
    },

    // 是否显示字符数统计
    showCharCount: {
      type: Boolean,
      default: false
    },

    // 错误提示
    error: {
      type: String,
      default: undefined
    },

    // 帮助文本
    help: {
      type: String,
      default: undefined
    }
  },

  emits: ['update:modelValue', 'focus', 'blur', 'keydown', 'clear'],

  data() {
    return {
      showPassword: false,
      inputId: `input-${uuidv4()}`
    }
  },

  methods: {
    handleInput(event: Event) {
      const target = event.target as HTMLInputElement
      this.$emit('update:modelValue', target.value)
    },

    handleFocus() {
      this.$emit('focus')
    },

    handleBlur() {
      this.$emit('blur')
    },

    handleClear() {
      this.$emit('update:modelValue', '')
      this.$emit('clear')
    },

    togglePasswordVisibility() {
      this.showPassword = !this.showPassword
    }
  }
})
</script>

<style scoped lang="scss">
.input-wrapper {
  width: 100%;
}

.input-label {
  display: block;
  margin-bottom: 8px;
  font-size: 14px;
  font-weight: 500;
  color: rgba(0, 0, 0, 0.85);
}

.input-required {
  color: #f5222d;
  margin-left: 4px;
}

.input-container {
  position: relative;
  display: flex;
  align-items: center;
}

.input {
  flex: 1;
  width: 100%;
  padding: 8px 12px;
  font-size: 14px;
  line-height: 1.5;
  color: rgba(0, 0, 0, 0.85);
  border: 1px solid #d9d9d9;
  border-radius: 4px;
  transition: all 0.3s ease;
  outline: none;

  &:hover:not(.input-disabled) {
    border-color: #40a9ff;
  }

  &:focus {
    border-color: #1890ff;
    box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
  }

  &.input-disabled {
    background-color: #f5f5f5;
    cursor: not-allowed;
    opacity: 0.6;
  }

  // 处理前缀的padding
  .input-prefix ~ & {
    padding-left: 8px;
  }
}

.input-prefix,
.input-suffix {
  padding: 0 8px;
  color: rgba(0, 0, 0, 0.45);
  font-size: 14px;
}

.input-prefix {
  margin-right: -8px;
}

.input-suffix {
  margin-left: -8px;
}

.input-clear,
.input-toggle-password {
  padding: 0 8px;
  background: none;
  border: none;
  color: rgba(0, 0, 0, 0.45);
  cursor: pointer;
  font-size: 14px;
  transition: color 0.3s ease;

  &:hover {
    color: rgba(0, 0, 0, 0.75);
  }
}

.input-error-message,
.input-help,
.input-char-count {
  margin-top: 4px;
  font-size: 12px;
  line-height: 1.5;
}

.input-error-message {
  color: #f5222d;
}

.input-help {
  color: rgba(0, 0, 0, 0.45);
}

.input-char-count {
  text-align: right;
  color: rgba(0, 0, 0, 0.45);
}

.input-error {
  .input {
    border-color: #f5222d;

    &:focus {
      box-shadow: 0 0 0 2px rgba(245, 34, 45, 0.2);
    }
  }
}
</style>
```

---

## 组件文档

### 7. 组件文档规范

**README.md 模板：**
```markdown
# Button 组件

## 简介
按钮是最常见的交互元素，用于触发操作或导航。

## 使用

### 基础用法
\`\`\`vue
<Button>Click me</Button>
\`\`\`

### 不同类型
\`\`\`vue
<Button type="primary">Primary</Button>
<Button type="dashed">Dashed</Button>
<Button type="text">Text</Button>
\`\`\`

### 不同大小
\`\`\`vue
<Button size="small">Small</Button>
<Button size="large">Large</Button>
\`\`\`

## API

### Props

| 参数 | 说明 | 类型 | 默认值 |
|------|------|------|-------|
| type | 按钮类型 | 'primary' \| 'default' \| 'dashed' \| 'text' | 'default' |
| size | 按钮大小 | 'small' \| 'middle' \| 'large' | 'middle' |
| disabled | 是否禁用 | boolean | false |
| loading | 是否加载中 | boolean | false |
| block | 是否块级 | boolean | false |
| icon | 图标 | string | - |
| htmlType | HTML type | 'button' \| 'submit' \| 'reset' | 'button' |

### Events

| 事件名 | 说明 | 回调参数 |
|--------|------|---------|
| click | 点击事件 | (event: MouseEvent) |

### Slots

| 插槽名 | 说明 |
|--------|------|
| default | 按钮内容 |

## 主题定制

通过CSS变量自定义主题：

\`\`\`css
:root {
  --btn-primary-color: #1890ff;
  --btn-primary-hover: #40a9ff;
  --btn-primary-active: #096dd9;
  --btn-radius: 4px;
}
\`\`\`

## 无障碍 (a11y)
- 支持键盘导航（Tab、Enter、Space）
- ARIA标签完整
- 高对比度颜色

## 浏览器兼容性
- Chrome ✓
- Firefox ✓
- Safari ✓
- Edge ✓
- IE 11 ✗

## 相关组件
- ButtonGroup - 按钮组
- Icon - 图标
```

---

## Storybook 集成

### 8. 使用 Storybook 展示组件

```bash
npm install -D storybook @storybook/vue3-vite
npx storybook init
```

**Button.stories.ts：**
```typescript
import type { Meta, StoryObj } from '@storybook/vue3'
import Button from './Button.vue'

// 元数据
const meta = {
  title: 'Components/Button',
  component: Button,
  tags: ['autodocs'],  // 自动生成文档
  argTypes: {
    type: {
      control: 'select',
      options: ['primary', 'default', 'dashed', 'text', 'link']
    },
    size: {
      control: 'select',
      options: ['small', 'middle', 'large']
    },
    disabled: {
      control: 'boolean'
    },
    loading: {
      control: 'boolean'
    },
    block: {
      control: 'boolean'
    },
    onClick: { action: 'clicked' }
  }
} satisfies Meta<typeof Button>

export default meta
type Story = StoryObj<typeof meta>

// 基础用法
export const Default: Story = {
  args: {
    children: 'Click me'
  }
}

// Primary类型
export const Primary: Story = {
  args: {
    type: 'primary',
    children: 'Primary Button'
  }
}

// 加载状态
export const Loading: Story = {
  args: {
    type: 'primary',
    loading: true,
    children: 'Loading'
  }
}

// 禁用状态
export const Disabled: Story = {
  args: {
    disabled: true,
    children: 'Disabled'
  }
}

// 不同大小
export const Sizes: Story = {
  render: () => ({
    template: `
      <div style="display: flex; gap: 8px;">
        <Button size="small">Small</Button>
        <Button size="middle">Middle</Button>
        <Button size="large">Large</Button>
      </div>
    `,
    components: { Button }
  })
}

// 所有类型
export const AllTypes: Story = {
  render: () => ({
    template: `
      <div style="display: flex; gap: 8px; flex-wrap: wrap;">
        <Button type="primary">Primary</Button>
        <Button type="default">Default</Button>
        <Button type="dashed">Dashed</Button>
        <Button type="text">Text</Button>
      </div>
    `,
    components: { Button }
  })
}
```

**运行 Storybook：**
```bash
npm run storybook
# 访问 http://localhost:6006
```

---

## 组件测试

### 9. 单元测试

```typescript
// Button.test.ts
import { describe, it, expect, vi } from 'vitest'
import { mount } from '@vue/test-utils'
import Button from './Button.vue'

describe('Button', () => {
  // 基础功能
  it('renders button with text', () => {
    const wrapper = mount(Button, {
      slots: {
        default: 'Click me'
      }
    })
    expect(wrapper.text()).toContain('Click me')
  })

  // Props验证
  it('applies correct type class', () => {
    const wrapper = mount(Button, {
      props: {
        type: 'primary'
      }
    })
    expect(wrapper.classes()).toContain('btn-primary')
  })

  it('applies correct size class', () => {
    const wrapper = mount(Button, {
      props: {
        size: 'large'
      }
    })
    expect(wrapper.classes()).toContain('btn-large')
  })

  // 交互测试
  it('emits click event', async () => {
    const wrapper = mount(Button, {
      slots: {
        default: 'Click me'
      }
    })

    await wrapper.trigger('click')
    expect(wrapper.emitted('click')).toHaveLength(1)
  })

  // 禁用状态
  it('does not emit click when disabled', async () => {
    const wrapper = mount(Button, {
      props: {
        disabled: true
      }
    })

    await wrapper.trigger('click')
    expect(wrapper.emitted('click')).toBeUndefined()
  })

  // 加载状态
  it('shows loading spinner when loading', () => {
    const wrapper = mount(Button, {
      props: {
        loading: true
      }
    })

    expect(wrapper.find('.btn-loading').exists()).toBe(true)
  })

  // 作用域slot
  it('renders slot content', () => {
    const wrapper = mount(Button, {
      slots: {
        default: '<span>Custom Content</span>'
      }
    })

    expect(wrapper.html()).toContain('Custom Content')
  })

  // 快照测试
  it('matches snapshot', () => {
    const wrapper = mount(Button, {
      props: {
        type: 'primary'
      },
      slots: {
        default: 'Snapshot Test'
      }
    })

    expect(wrapper.html()).toMatchSnapshot()
  })
})
```

**运行测试：**
```bash
npm run test
npm run test:coverage  # 生成覆盖率报告
```

---

## 版本管理和发布

### 10. 版本规范

**语义化版本 (Semantic Versioning)：**
```
版本格式：MAJOR.MINOR.PATCH

MAJOR - 主版本号（不兼容的API改动）
├─ 删除功能
├─ 改变API签名
└─ 例：1.0.0 → 2.0.0

MINOR - 次版本号（新增功能，向下兼容）
├─ 新增props
├─ 新增events
├─ 新增slots
└─ 例：1.0.0 → 1.1.0

PATCH - 修订版本号（bug修复）
├─ 样式调整
├─ 性能优化
├─ bug修复
└─ 例：1.0.0 → 1.0.1

预发布版本：
├─ 1.0.0-alpha - 内部测试
├─ 1.0.0-beta - 公开测试
└─ 1.0.0-rc.1 - 候选版本
```

**更新日志 (CHANGELOG)：**
```markdown
# 更新日志

## [1.1.0] - 2024-10-27

### 新增
- Button组件新增 `danger` 属性，用于危险操作确认
- Input组件新增 `showCharCount` 属性，显示字符数统计
- 新增 `useAsync` 组合式函数，简化异步操作

### 改进
- 优化Button组件的样式，提升视觉层级
- 改进Input组件的键盘交互
- 性能优化：减小bundle体积10%

### 修复
- 修复Select组件在多选模式下的选中状态显示问题
- 修复Modal组件在移动设备上的滚动问题
- 修复Dialog组件的焦点管理

### 破坏性改动
- ❌ 移除了 `Message.info()` 方法，改用 `message.create({ type: 'info' })`

## [1.0.0] - 2024-09-27

### 新增
- 初始版本发布
- 包含30+基础组件
- 完整的TypeScript支持
- Storybook文档
```

**发布流程：**
```bash
# 1. 确保所有测试通过
npm run test

# 2. 构建所有包
npm run build

# 3. 更新版本号
npm run version

# 4. 发布到npm
npm publish

# 5. 推送到git
git push --follow-tags

# 6. 发布Release到GitHub
gh release create v1.1.0 --generate-notes
```

---

## 最佳实践

### 11. 组件库的设计原则

**易用性原则：**
```typescript
// ❌ 不好的设计
<Component config={{ deep: { nested: { structure: true } } }} />

// ✅ 好的设计
<Component deepNested />
```

**一致性原则：**
```
命名规范：
├─ 组件名：PascalCase (Button, Input, Modal)
├─ Props：camelCase (modelValue, maxLength)
├─ Events：kebab-case (@click, @update:modelValue)
└─ CSS类：kebab-case (.btn-primary, .input-error)

API风格一致：
├─ 所有组件都支持disabled
├─ 所有组件都支持class绑定
├─ 所有表单组件都支持v-model
└─ 所有容器组件都支持default slot
```

**可访问性原则：**
```html
<!-- ❌ 不好 -->
<div @click="toggle">Click me</div>

<!-- ✅ 好的做法 -->
<button
  :aria-pressed="isActive"
  :aria-label="label"
  @click="toggle"
>
  Click me
</button>
```

**文档完整性：**
```
每个组件需要：
├─ README.md - 使用指南
├─ TypeScript类型定义 - 完整的types
├─ 单元测试 - 至少80%覆盖率
├─ Storybook - 交互式演示
├─ JSDoc注释 - 代码注释
└─ 无障碍说明 - a11y支持
```

---

## 组件库工具链

### 12. 推荐工具

**构建工具：**
```
Vite + esbuild
├─ 极快的构建速度
├─ 支持TS、Vue、React
└─ 支持CSS/SCSS预处理

Rollup
├─ 生成多种格式产物 (ESM, UMD, CJS)
├─ Tree-shaking友好
└─ 库开发首选
```

**文档工具：**
```
Storybook ⭐
├─ 最成熟的组件文档方案
├─ 交互式演示
└─ 自动生成文档

VitePress / Docusaurus
├─ 简洁的Markdown文档
├─ 适合大型文档
└─ 静态生成
```

**测试工具：**
```
Vitest
├─ Vite原生测试框架
├─ 极快的执行速度
└─ 类Jest的API

@vue/test-utils / Testing Library
├─ 组件单元测试
├─ 交互测试
└─ 快照测试

Cypress / Playwright
└─ E2E端到端测试
```

**代码质量：**
```
ESLint + Prettier
├─ 代码风格统一
├─ 自动格式化
└─ Pre-commit钩子

TypeScript
├─ 类型安全
├─ IDE支持
└─ 自文档化
```

---

## 实战案例

### 13. 组件库项目结构示例

```bash
# 初始化项目
npm create vite@latest my-ui-lib -- --template vue-ts

# 安装依赖
cd my-ui-lib
npm install

# 安装开发工具
npm install -D \
  typescript \
  vue \
  sass \
  storybook @storybook/vue3-vite \
  vitest @vitest/ui \
  @vue/test-utils \
  jsdom \
  eslint prettier \
  @commitlint/cli @commitlint/config-conventional \
  lerna

# 初始化Monorepo
npx lerna init
```

**完整的package.json：**
```json
{
  "name": "@myorg/ui",
  "version": "1.0.0",
  "type": "module",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js",
      "require": "./dist/index.cjs"
    },
    "./styles": "./dist/style.css"
  },
  "files": ["dist"],
  "scripts": {
    "dev": "vite",
    "build": "vite build && vue-tsc --emitDeclarationOnly",
    "preview": "vite preview",
    "storybook": "storybook dev -p 6006",
    "build-storybook": "storybook build",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage",
    "lint": "eslint src --ext .vue,.js,.ts",
    "lint:fix": "eslint src --ext .vue,.js,.ts --fix",
    "format": "prettier --write src",
    "type-check": "vue-tsc --noEmit"
  },
  "dependencies": {
    "vue": "^3.3.0"
  },
  "devDependencies": {
    "@storybook/vue3-vite": "^7.0.0",
    "@vue/test-utils": "^2.4.0",
    "typescript": "^5.0.0",
    "vitest": "^0.34.0"
  }
}
```

---

## 快速自测

- [ ] 能解释什么是组件库吗？
- [ ] 理解设计令牌的作用吗？
- [ ] 能设计一个完整的Button组件吗？
- [ ] 知道如何编写组件文档吗？
- [ ] 能用Storybook展示组件吗？
- [ ] 会写组件的单元测试吗？
- [ ] 理解Monorepo的结构吗？
- [ ] 知道组件库的版本管理吗？
- [ ] 能设计无障碍的组件吗？
- [ ] 知道组件库的打包方案吗？

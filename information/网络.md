# ğŸŒ ç½‘ç»œè¿æ¥åŸç†è¯¦è§£

## ğŸ¤ TCPä¸‰æ¬¡æ¡æ‰‹ - å»ºç«‹è¿æ¥çš„è‰ºæœ¯

> **å½¢è±¡æ¯”å–»**ï¼šå°±åƒä¸¤ä¸ªäººé€šè¿‡ç”µè¯å»ºç«‹é€šè¯ä¸€æ ·ï¼Œéœ€è¦ç¡®è®¤åŒæ–¹éƒ½èƒ½å¬åˆ°å¯¹æ–¹çš„å£°éŸ³ã€‚

### ğŸ“ ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹

```
å®¢æˆ·ç«¯ (Client)                    æœåŠ¡å™¨ (Server)
     |                                  |
     |        â‘  SYN (æˆ‘æƒ³å’Œä½ è¯´è¯)         |
     |--------------------------------->|
     |                                  |
     |    â‘¡ SYN-ACK (æˆ‘å¬åˆ°äº†ï¼Œä½ å¬åˆ°å—ï¼Ÿ)   |
     |<---------------------------------|
     |                                  |
     |        â‘¢ ACK (å¬åˆ°äº†ï¼Œå¼€å§‹å§ï¼)      |
     |--------------------------------->|
     |                                  |
     |         ğŸ‰ è¿æ¥å»ºç«‹æˆåŠŸï¼           |
     |<================================>|
```

### ğŸ­ è§’è‰²æ‰®æ¼”è®°å¿†æ³•

**ç¬¬ä¸€æ¬¡æ¡æ‰‹ (SYN)**
```
å®¢æˆ·ç«¯: "ä½ å¥½ï¼Œæˆ‘æ˜¯å°æ˜ï¼Œæˆ‘æƒ³å’Œä½ å»ºç«‹è¿æ¥ï¼"
(å‘é€: SYN=1, seq=100)

æœåŠ¡å™¨: "æ”¶åˆ°å°æ˜çš„è¿æ¥è¯·æ±‚..."
```

**ç¬¬äºŒæ¬¡æ¡æ‰‹ (SYN-ACK)**
```
æœåŠ¡å™¨: "ä½ å¥½å°æ˜ï¼Œæˆ‘æ˜¯æœåŠ¡å™¨å°æï¼Œæˆ‘æ”¶åˆ°äº†ä½ çš„è¯·æ±‚ï¼Œ
        æˆ‘ä¹Ÿæƒ³å’Œä½ è¿æ¥ï¼Œä½ èƒ½æ”¶åˆ°æˆ‘çš„å›å¤å—ï¼Ÿ"
(å‘é€: SYN=1, ACK=1, seq=200, ack=101)

å®¢æˆ·ç«¯: "æ”¶åˆ°å°æçš„ç¡®è®¤..."
```

**ç¬¬ä¸‰æ¬¡æ¡æ‰‹ (ACK)**
```
å®¢æˆ·ç«¯: "å°æä½ å¥½ï¼Œæˆ‘æ”¶åˆ°äº†ä½ çš„å›å¤ï¼Œ
        ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹æ­£å¼é€šä¿¡äº†ï¼"
(å‘é€: ACK=1, seq=101, ack=201)

åŒæ–¹: "è¿æ¥å»ºç«‹æˆåŠŸï¼ğŸ‰"
```

### ğŸ” æŠ€æœ¯ç»†èŠ‚è§£æ

```javascript
// TCPä¸‰æ¬¡æ¡æ‰‹çŠ¶æ€æœº
class TCPHandshake {
  constructor() {
    this.clientState = 'CLOSED';
    this.serverState = 'LISTEN';
  }

  // ç¬¬ä¸€æ¬¡æ¡æ‰‹
  firstHandshake() {
    console.log('ğŸ“¤ å®¢æˆ·ç«¯å‘é€ SYN');
    this.clientState = 'SYN_SENT';
    
    return {
      type: 'SYN',
      seq: Math.floor(Math.random() * 1000),
      message: 'å®¢æˆ·ç«¯: æˆ‘æƒ³å»ºç«‹è¿æ¥ï¼'
    };
  }

  // ç¬¬äºŒæ¬¡æ¡æ‰‹
  secondHandshake(synPacket) {
    console.log('ğŸ“¤ æœåŠ¡å™¨å‘é€ SYN-ACK');
    this.serverState = 'SYN_RCVD';
    
    return {
      type: 'SYN-ACK',
      seq: Math.floor(Math.random() * 1000),
      ack: synPacket.seq + 1,
      message: 'æœåŠ¡å™¨: æ”¶åˆ°ï¼æˆ‘ä¹Ÿæƒ³è¿æ¥ï¼Œä½ æ”¶åˆ°å—ï¼Ÿ'
    };
  }

  // ç¬¬ä¸‰æ¬¡æ¡æ‰‹
  thirdHandshake(synAckPacket) {
    console.log('ğŸ“¤ å®¢æˆ·ç«¯å‘é€ ACK');
    this.clientState = 'ESTABLISHED';
    this.serverState = 'ESTABLISHED';
    
    return {
      type: 'ACK',
      seq: synAckPacket.ack,
      ack: synAckPacket.seq + 1,
      message: 'å®¢æˆ·ç«¯: æ”¶åˆ°ï¼è¿æ¥å»ºç«‹æˆåŠŸï¼'
    };
  }
}
```

### ğŸ¤” ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡è€Œä¸æ˜¯ä¸¤æ¬¡ï¼Ÿ

**ä¸¤æ¬¡æ¡æ‰‹çš„é—®é¢˜ - å†å²åŒ…å¹²æ‰°**
```
æ—¶é—´çº¿:
T1: å®¢æˆ·ç«¯å‘é€SYN1 â†’ ç½‘ç»œå»¶è¿Ÿï¼Œå¾ˆä¹…æ‰åˆ°è¾¾
T2: å®¢æˆ·ç«¯è¶…æ—¶ï¼Œå‘é€SYN2 â†’ å¿«é€Ÿåˆ°è¾¾ï¼Œå»ºç«‹è¿æ¥
T3: è¿æ¥æ­£å¸¸ä½¿ç”¨åå…³é—­
T4: SYN1ç»ˆäºåˆ°è¾¾æœåŠ¡å™¨ â†’ æœåŠ¡å™¨è¯¯ä»¥ä¸ºæ˜¯æ–°è¿æ¥è¯·æ±‚ï¼

å¦‚æœåªæœ‰ä¸¤æ¬¡æ¡æ‰‹:
æœåŠ¡å™¨æ”¶åˆ°SYN1 â†’ ç›´æ¥å»ºç«‹è¿æ¥ â†’ æµªè´¹èµ„æºï¼

ä¸‰æ¬¡æ¡æ‰‹çš„ä¼˜åŠ¿:
æœåŠ¡å™¨æ”¶åˆ°SYN1 â†’ å‘é€SYN-ACK â†’ ç­‰å¾…å®¢æˆ·ç«¯ç¡®è®¤
å®¢æˆ·ç«¯æ”¶åˆ°SYN-ACK â†’ "è¿™ä¸æ˜¯æˆ‘ç°åœ¨è¦çš„è¿æ¥" â†’ ä¸å›å¤ACK
æœåŠ¡å™¨è¶…æ—¶ â†’ è‡ªåŠ¨å…³é—­è¿æ¥ â†’ é¿å…æµªè´¹ï¼
```

---

## ğŸ‘‹ TCPå››æ¬¡æŒ¥æ‰‹ - ä¼˜é›…åœ°å‘Šåˆ«

> **å½¢è±¡æ¯”å–»**ï¼šå°±åƒæ‰“ç”µè¯ç»“æŸæ—¶ï¼ŒåŒæ–¹éƒ½è¦ç¡®è®¤å¯¹æ–¹å·²ç»æŒ‚æœºï¼Œç¡®ä¿æ²¡æœ‰é—æ¼çš„è¯è¦è¯´ã€‚

### ğŸ“ å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹

```
å®¢æˆ·ç«¯ (Client)                    æœåŠ¡å™¨ (Server)
     |                                  |
     |      â‘  FIN (æˆ‘è¯´å®Œäº†ï¼Œè¦æŒ‚æœºäº†)      |
     |--------------------------------->|
     |                                  |
     |       â‘¡ ACK (å¥½çš„ï¼Œæˆ‘çŸ¥é“äº†)        |
     |<---------------------------------|
     |                                  |
     |    â‘¢ FIN (æˆ‘ä¹Ÿè¯´å®Œäº†ï¼Œæˆ‘ä¹Ÿè¦æŒ‚æœº)     |
     |<---------------------------------|
     |                                  |
     |       â‘£ ACK (å¥½çš„ï¼Œå†è§ï¼)          |
     |--------------------------------->|
     |                                  |
     |         ğŸ’” è¿æ¥å…³é—­å®Œæˆ            |
     |                                  |
```

### ğŸ­ å››æ¬¡æŒ¥æ‰‹æƒ…æ™¯å‰§

**ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ (FIN)**
```
å®¢æˆ·ç«¯: "å°æï¼Œæˆ‘è¿™è¾¹çš„äº‹æƒ…è¯´å®Œäº†ï¼Œå‡†å¤‡æŒ‚ç”µè¯äº†ã€‚"
(å‘é€: FIN=1, seq=300)

æœåŠ¡å™¨: "æ”¶åˆ°å°æ˜è¦ç»“æŸé€šè¯çš„ä¿¡å·..."
```

**ç¬¬äºŒæ¬¡æŒ¥æ‰‹ (ACK)**
```
æœåŠ¡å™¨: "å¥½çš„å°æ˜ï¼Œæˆ‘çŸ¥é“ä½ è¦ç»“æŸäº†ï¼Œä½†æˆ‘è¿˜æœ‰ç‚¹äº‹è¦è¯´ï¼Œ
        ä½ å…ˆåˆ«æŒ‚ï¼Œç­‰æˆ‘è¯´å®Œã€‚"
(å‘é€: ACK=1, ack=301)

å®¢æˆ·ç«¯: "å¥½çš„ï¼Œæˆ‘ç­‰ä½ è¯´å®Œ..." (è¿›å…¥ FIN_WAIT_2 çŠ¶æ€)
```

**ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ (FIN)**
```
æœåŠ¡å™¨: "å°æ˜ï¼Œæˆ‘ç°åœ¨ä¹Ÿè¯´å®Œäº†ï¼Œå¯ä»¥æŒ‚ç”µè¯äº†ã€‚"
(å‘é€: FIN=1, seq=400)

å®¢æˆ·ç«¯: "æ”¶åˆ°å°æä¹Ÿè¦ç»“æŸçš„ä¿¡å·..."
```

**ç¬¬å››æ¬¡æŒ¥æ‰‹ (ACK)**
```
å®¢æˆ·ç«¯: "å¥½çš„å°æï¼Œå†è§ï¼"
(å‘é€: ACK=1, ack=401)

åŒæ–¹: "é€šè¯ç»“æŸ ğŸ’”"
```

### ğŸ” å››æ¬¡æŒ¥æ‰‹ä»£ç æ¨¡æ‹Ÿ

```javascript
// TCPå››æ¬¡æŒ¥æ‰‹çŠ¶æ€æœº
class TCPGoodbye {
  constructor() {
    this.clientState = 'ESTABLISHED';
    this.serverState = 'ESTABLISHED';
  }

  // ç¬¬ä¸€æ¬¡æŒ¥æ‰‹
  firstWave() {
    console.log('ğŸ‘‹ å®¢æˆ·ç«¯å‘é€ FIN');
    this.clientState = 'FIN_WAIT_1';
    
    return {
      type: 'FIN',
      seq: 300,
      message: 'å®¢æˆ·ç«¯: æˆ‘è¦å…³é—­è¿æ¥äº†ï¼'
    };
  }

  // ç¬¬äºŒæ¬¡æŒ¥æ‰‹
  secondWave(finPacket) {
    console.log('âœ‹ æœåŠ¡å™¨å‘é€ ACK');
    this.serverState = 'CLOSE_WAIT';
    
    return {
      type: 'ACK',
      ack: finPacket.seq + 1,
      message: 'æœåŠ¡å™¨: æ”¶åˆ°ï¼Œä½†æˆ‘è¿˜æœ‰æ•°æ®è¦å‘é€ï¼'
    };
  }

  // ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹
  thirdWave() {
    console.log('ğŸ‘‹ æœåŠ¡å™¨å‘é€ FIN');
    this.serverState = 'LAST_ACK';
    this.clientState = 'FIN_WAIT_2'; // æ”¶åˆ°ç¬¬äºŒæ¬¡æŒ¥æ‰‹åçš„çŠ¶æ€
    
    return {
      type: 'FIN',
      seq: 400,
      message: 'æœåŠ¡å™¨: æˆ‘ä¹Ÿå‡†å¤‡å…³é—­è¿æ¥äº†ï¼'
    };
  }

  // ç¬¬å››æ¬¡æŒ¥æ‰‹
  fourthWave(finPacket) {
    console.log('âœ… å®¢æˆ·ç«¯å‘é€ ACK');
    this.clientState = 'TIME_WAIT';
    
    setTimeout(() => {
      this.clientState = 'CLOSED';
      this.serverState = 'CLOSED';
      console.log('ğŸ’” è¿æ¥å®Œå…¨å…³é—­');
    }, 2000); // 2MSLç­‰å¾…æ—¶é—´
    
    return {
      type: 'ACK',
      ack: finPacket.seq + 1,
      message: 'å®¢æˆ·ç«¯: å†è§ï¼'
    };
  }
}
```

### ğŸ¤” ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡è€Œä¸æ˜¯ä¸‰æ¬¡ï¼Ÿ

**å…³é”®åŒºåˆ«ï¼šå…¨åŒå·¥é€šä¿¡**
```
TCPè¿æ¥æ˜¯å…¨åŒå·¥çš„ = åŒå‘è½¦é“

å»ºç«‹è¿æ¥æ—¶ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ï¼š
åŒæ–¹åŒæ—¶è¡¨è¾¾"æˆ‘æƒ³é€šä¿¡"çš„æ„æ„¿
å¯ä»¥æŠŠSYNå’ŒACKåˆå¹¶åœ¨ä¸€ä¸ªåŒ…ä¸­

å…³é—­è¿æ¥æ—¶ï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰ï¼š
æ¯ä¸ªæ–¹å‘éƒ½éœ€è¦ç‹¬ç«‹å…³é—­
Aæ–¹è¯´å®Œäº† â‰  Bæ–¹ä¹Ÿè¯´å®Œäº†

å½¢è±¡æ¯”å–»ï¼š
å»ºç«‹è¿æ¥ = åŒæ–¹åŒæ—¶æ¡æ‰‹ï¼š"æˆ‘ä»¬åšæœ‹å‹å§ï¼"
å…³é—­è¿æ¥ = å„è‡ªå‘Šåˆ«ï¼š
  A: "æˆ‘è¦èµ°äº†"
  B: "çŸ¥é“äº†"
  B: "æˆ‘ä¹Ÿè¦èµ°äº†"  â† ä¸èƒ½çœç•¥ï¼ŒBå¯èƒ½è¿˜æœ‰è¯è¯´
  A: "å¥½çš„å†è§"
```

---

## ğŸ” TLSæ¡æ‰‹ - å®‰å…¨é€šä¿¡çš„å¯†é’¥äº¤æ¢

> **å½¢è±¡æ¯”å–»**ï¼šå°±åƒä¸¤ä¸ªé—´è°è§é¢ï¼Œéœ€è¦å…ˆç¡®è®¤èº«ä»½ï¼Œå†äº¤æ¢æš—å·ï¼Œæœ€åç”¨æš—å·åŠ å¯†é€šä¿¡ã€‚

### ğŸ•µï¸ TLS 1.2 æ¡æ‰‹è¿‡ç¨‹

```
å®¢æˆ·ç«¯ (Client)                     æœåŠ¡å™¨ (Server)
     |                                   |
     |    â‘  Client Hello (æˆ‘æ”¯æŒè¿™äº›åŠ å¯†)    |
     |---------------------------------->|
     |                                   |
     |    â‘¡ Server Hello (æˆ‘é€‰æ‹©è¿™ç§åŠ å¯†)    |
     |    â‘¢ Certificate (è¿™æ˜¯æˆ‘çš„è¯ä¹¦)      |
     |    â‘£ Server Hello Done (æˆ‘è¯´å®Œäº†)   |
     |<----------------------------------|
     |                                   |
     |    â‘¤ éªŒè¯è¯ä¹¦ & ç”Ÿæˆé¢„ä¸»å¯†é’¥          |
     |    â‘¥ Client Key Exchange (åŠ å¯†å¯†é’¥) |
     |    â‘¦ Change Cipher Spec (åˆ‡æ¢åŠ å¯†)  |
     |    â‘§ Finished (æ¡æ‰‹å®ŒæˆéªŒè¯)        |
     |---------------------------------->|
     |                                   |
     |    â‘¨ Change Cipher Spec (ç¡®è®¤åˆ‡æ¢)  |
     |    â‘© Finished (ç¡®è®¤æ¡æ‰‹å®Œæˆ)        |
     |<----------------------------------|
     |                                   |
     |         ğŸ”’ å®‰å…¨é€šä¿¡å¼€å§‹ï¼            |
     |<=================================>|
```

### ğŸ­ TLSæ¡æ‰‹é—´è°ç‰ˆæƒ…æ™¯å‰§

**ç¬¬ä¸€å¹•ï¼šåˆæ¬¡æ¥è§¦**
```
å®¢æˆ·ç«¯ (ç‰¹å·¥A): "æˆ‘æ˜¯ç‰¹å·¥Aï¼Œæˆ‘æ”¯æŒAES-256ã€RSAç­‰åŠ å¯†æ–¹å¼ï¼Œ
                è¿™æ˜¯æˆ‘çš„éšæœºæ•° [ClientRandom]"

æœåŠ¡å™¨ (ç‰¹å·¥B): "æ”¶åˆ°ç‰¹å·¥Açš„æš—å·é€‰é¡¹..."
```

**ç¬¬äºŒå¹•ï¼šèº«ä»½éªŒè¯**
```
æœåŠ¡å™¨ (ç‰¹å·¥B): "æˆ‘æ˜¯ç‰¹å·¥Bï¼Œæˆ‘é€‰æ‹©AES-256åŠ å¯†ï¼Œ
                è¿™æ˜¯æˆ‘çš„èº«ä»½è¯æ˜ [æ•°å­—è¯ä¹¦]ï¼Œ
                è¿™æ˜¯æˆ‘çš„éšæœºæ•° [ServerRandom]"

å®¢æˆ·ç«¯ (ç‰¹å·¥A): "è®©æˆ‘éªŒè¯ä¸€ä¸‹ä½ çš„èº«ä»½è¯æ˜..."
               (éªŒè¯è¯ä¹¦é“¾ï¼Œæ£€æŸ¥CAç­¾å)
               "èº«ä»½éªŒè¯é€šè¿‡ï¼"
```

**ç¬¬ä¸‰å¹•ï¼šå¯†é’¥äº¤æ¢**
```
å®¢æˆ·ç«¯ (ç‰¹å·¥A): "æˆ‘ç”Ÿæˆäº†ä¸€ä¸ªé¢„ä¸»å¯†é’¥ [PreMaster Secret]ï¼Œ
                ç”¨ä½ çš„å…¬é’¥åŠ å¯†å‘ç»™ä½  [ClientKeyExchange]"

æœåŠ¡å™¨ (ç‰¹å·¥B): "æ”¶åˆ°ï¼Œæˆ‘ç”¨ç§é’¥è§£å¯†å¾—åˆ°äº†é¢„ä¸»å¯†é’¥"

åŒæ–¹åŒæ—¶è®¡ç®—: 
ä¸»å¯†é’¥ = PRF(PreMaster, ClientRandom + ServerRandom)
```

**ç¬¬å››å¹•ï¼šç¡®è®¤åŠ å¯†**
```
å®¢æˆ·ç«¯ (ç‰¹å·¥A): "ä»ç°åœ¨å¼€å§‹ç”¨æ–°çš„åŠ å¯†æ–¹å¼é€šä¿¡ï¼
                è¿™æ˜¯æˆ‘çš„æ¡æ‰‹å®ŒæˆéªŒè¯ä¿¡æ¯"

æœåŠ¡å™¨ (ç‰¹å·¥B): "å¥½çš„ï¼Œæˆ‘ä¹Ÿåˆ‡æ¢åˆ°æ–°çš„åŠ å¯†æ–¹å¼ï¼
                è¿™æ˜¯æˆ‘çš„æ¡æ‰‹å®ŒæˆéªŒè¯ä¿¡æ¯"

åŒæ–¹: "ğŸ”’ å®‰å…¨é€šé“å»ºç«‹æˆåŠŸï¼ç°åœ¨å¯ä»¥ä¼ è¾“æœºå¯†ä¿¡æ¯äº†ï¼"
```

### ğŸ” TLSæ¡æ‰‹ä»£ç æ¨¡æ‹Ÿ

```javascript
// TLSæ¡æ‰‹æ¨¡æ‹Ÿå™¨
class TLSHandshake {
  constructor() {
    this.clientRandom = this.generateRandom();
    this.serverRandom = null;
    this.preMasterSecret = null;
    this.masterSecret = null;
    this.cipherSuite = null;
  }

  // ç”Ÿæˆéšæœºæ•°
  generateRandom() {
    return 'random_' + Math.random().toString(36).substr(2, 9);
  }

  // 1. Client Hello
  clientHello() {
    console.log('ğŸ¤ Client Hello');
    return {
      version: 'TLS 1.2',
      random: this.clientRandom,
      cipherSuites: ['AES-256-GCM', 'AES-128-GCM', 'ChaCha20-Poly1305'],
      message: 'å®¢æˆ·ç«¯: æˆ‘æ”¯æŒè¿™äº›åŠ å¯†å¥—ä»¶ï¼Œé€‰ä¸€ä¸ªå§ï¼'
    };
  }

  // 2-4. Server Hello + Certificate + Done
  serverHello(clientHello) {
    console.log('ğŸ“‹ Server Hello + Certificate');
    this.serverRandom = this.generateRandom();
    this.cipherSuite = clientHello.cipherSuites[0]; // é€‰æ‹©æœ€å¼ºçš„
    
    return {
      version: 'TLS 1.2',
      random: this.serverRandom,
      cipherSuite: this.cipherSuite,
      certificate: {
        subject: 'CN=example.com',
        issuer: 'CN=Let\'s Encrypt',
        publicKey: 'RSA-2048-PUBLIC-KEY',
        signature: 'VALID-CA-SIGNATURE'
      },
      message: 'æœåŠ¡å™¨: æˆ‘é€‰æ‹©AES-256ï¼Œè¿™æ˜¯æˆ‘çš„è¯ä¹¦ï¼'
    };
  }

  // 5-8. Client Key Exchange + Change Cipher
  clientKeyExchange(serverHello) {
    console.log('ğŸ” Client Key Exchange');
    
    // éªŒè¯è¯ä¹¦ï¼ˆç®€åŒ–ï¼‰
    if (!this.verifyCertificate(serverHello.certificate)) {
      throw new Error('è¯ä¹¦éªŒè¯å¤±è´¥ï¼');
    }
    
    // ç”Ÿæˆé¢„ä¸»å¯†é’¥
    this.preMasterSecret = this.generateRandom();
    
    // è®¡ç®—ä¸»å¯†é’¥
    this.masterSecret = this.computeMasterSecret();
    
    return {
      preMasterSecret: this.encryptWithPublicKey(this.preMasterSecret),
      changeCipherSpec: true,
      finished: this.computeHandshakeHash('client'),
      message: 'å®¢æˆ·ç«¯: å¯†é’¥å·²å‘é€ï¼Œåˆ‡æ¢åˆ°åŠ å¯†æ¨¡å¼ï¼'
    };
  }

  // 9-10. Server Change Cipher + Finished
  serverFinished(clientKeyExchange) {
    console.log('âœ… Server Finished');
    
    // è§£å¯†é¢„ä¸»å¯†é’¥
    this.preMasterSecret = this.decryptWithPrivateKey(clientKeyExchange.preMasterSecret);
    
    // è®¡ç®—ä¸»å¯†é’¥
    this.masterSecret = this.computeMasterSecret();
    
    return {
      changeCipherSpec: true,
      finished: this.computeHandshakeHash('server'),
      message: 'æœåŠ¡å™¨: æ¡æ‰‹å®Œæˆï¼Œå®‰å…¨é€šä¿¡å¼€å§‹ï¼'
    };
  }

  // è¾…åŠ©æ–¹æ³•
  verifyCertificate(cert) {
    console.log('ğŸ” éªŒè¯è¯ä¹¦...');
    // ç®€åŒ–çš„è¯ä¹¦éªŒè¯
    return cert.signature === 'VALID-CA-SIGNATURE';
  }

  computeMasterSecret() {
    // PRF (Pseudo-Random Function)
    return `master_secret_${this.preMasterSecret}_${this.clientRandom}_${this.serverRandom}`;
  }

  computeHandshakeHash(side) {
    return `handshake_hash_${side}_${this.masterSecret}`;
  }

  encryptWithPublicKey(data) {
    return `encrypted_${data}`;
  }

  decryptWithPrivateKey(encryptedData) {
    return encryptedData.replace('encrypted_', '');
  }
}

// å®Œæ•´çš„TLSæ¡æ‰‹æ¼”ç¤º
function demonstrateTLSHandshake() {
  console.log('ğŸ¬ TLSæ¡æ‰‹æ¼”ç¤ºå¼€å§‹\n');
  
  const client = new TLSHandshake();
  const server = new TLSHandshake();
  
  try {
    // 1. Client Hello
    const clientHello = client.clientHello();
    console.log(clientHello.message);
    
    // 2-4. Server Hello
    const serverHello = server.serverHello(clientHello);
    console.log(serverHello.message);
    
    // 5-8. Client Key Exchange
    const clientKeyExchange = client.clientKeyExchange(serverHello);
    console.log(clientKeyExchange.message);
    
    // 9-10. Server Finished
    const serverFinished = server.serverFinished(clientKeyExchange);
    console.log(serverFinished.message);
    
    console.log('\nğŸ‰ TLSæ¡æ‰‹æˆåŠŸå®Œæˆï¼');
    console.log(`ğŸ”’ ä½¿ç”¨åŠ å¯†å¥—ä»¶: ${client.cipherSuite}`);
    console.log(`ğŸ”‘ ä¸»å¯†é’¥: ${client.masterSecret.substr(0, 20)}...`);
    
  } catch (error) {
    console.error('âŒ TLSæ¡æ‰‹å¤±è´¥:', error.message);
  }
}
```

### ğŸ†š TLS 1.3 çš„æ”¹è¿› - æ›´å¿«çš„æ¡æ‰‹

```
TLS 1.2 (4æ¬¡å¾€è¿”)          TLS 1.3 (2æ¬¡å¾€è¿”)
     |                           |
     | Client Hello              | Client Hello + Key Share
     |-------------------------->|-------------------------->
     |                           |
     | Server Hello              | Server Hello + Key Share
     | Certificate               | Certificate + Finished
     | Key Exchange              |
     | Server Done               |
     |<--------------------------|<--------------------------
     |                           |
     | Key Exchange              |
     | Change Cipher             | Finished
     | Finished                  |
     |-------------------------->|-------------------------->
     |                           |
     | Change Cipher             |
     | Finished                  |
     |<--------------------------|
     |                           |
     | ğŸ”’ å¼€å§‹åŠ å¯†é€šä¿¡            | ğŸ”’ å¼€å§‹åŠ å¯†é€šä¿¡
```

**TLS 1.3 çš„å…³é”®æ”¹è¿›**
```javascript
// TLS 1.3 çš„é›¶RTTç‰¹æ€§
class TLS13ZeroRTT {
  // ç¬¬ä¸€æ¬¡è¿æ¥æ—¶ä¿å­˜å‚æ•°
  saveSessionParams(params) {
    localStorage.setItem('tls13_session', JSON.stringify({
      resumptionSecret: params.resumptionSecret,
      ticketAge: Date.now(),
      maxEarlyData: 16384
    }));
  }

  // åç»­è¿æ¥å¯ä»¥ç«‹å³å‘é€æ•°æ®
  sendEarlyData(data) {
    const session = JSON.parse(localStorage.getItem('tls13_session'));
    if (session && this.isSessionValid(session)) {
      console.log('âš¡ 0-RTT: ç«‹å³å‘é€æ—©æœŸæ•°æ®');
      return this.encryptEarlyData(data, session.resumptionSecret);
    }
    return null;
  }

  isSessionValid(session) {
    const age = Date.now() - session.ticketAge;
    return age < 7 * 24 * 60 * 60 * 1000; // 7å¤©æœ‰æ•ˆæœŸ
  }
}
```

---

## ğŸ¯ è®°å¿†å£è¯€

### TCPä¸‰æ¬¡æ¡æ‰‹
```
ğŸ‘¨â€ğŸ’» "ä½ å¥½å—ï¼Ÿ" (SYN)
ğŸ‘©â€ğŸ’» "æˆ‘å¾ˆå¥½ï¼Œä½ å¥½å—ï¼Ÿ" (SYN-ACK)  
ğŸ‘¨â€ğŸ’» "æˆ‘ä¹Ÿå¾ˆå¥½ï¼" (ACK)
ğŸ‰ å¼€å§‹èŠå¤©ï¼
```

### TCPå››æ¬¡æŒ¥æ‰‹
```
ğŸ‘¨â€ğŸ’» "æˆ‘è¦èµ°äº†" (FIN)
ğŸ‘©â€ğŸ’» "çŸ¥é“äº†" (ACK)
ğŸ‘©â€ğŸ’» "æˆ‘ä¹Ÿè¦èµ°äº†" (FIN)
ğŸ‘¨â€ğŸ’» "å¥½çš„å†è§" (ACK)
ğŸ’” å„è‡ªç¦»å¼€
```

### TLSæ¡æ‰‹
```
ğŸ‘¨â€ğŸ’» "æˆ‘ä»¬ç”¨ä»€ä¹ˆæš—å·ï¼Ÿ" (Client Hello)
ğŸ‘©â€ğŸ’» "ç”¨è¿™ä¸ªï¼Œè¿™æ˜¯æˆ‘çš„èº«ä»½è¯" (Server Hello + Cert)
ğŸ‘¨â€ğŸ’» "éªŒè¯é€šè¿‡ï¼Œè¿™æ˜¯å¯†é’¥" (Key Exchange)
ğŸ”’ "å¼€å§‹åŠ å¯†é€šä¿¡ï¼"
```

---

## ğŸ› ï¸ å®ç”¨å·¥å…·å’Œè°ƒè¯•

### ç½‘ç»œæŠ“åŒ…åˆ†æå·¥å…·
```bash
# ä½¿ç”¨ tcpdump è§‚å¯Ÿä¸‰æ¬¡æ¡æ‰‹
sudo tcpdump -i any -nn 'port 80' -v

# ä½¿ç”¨ wireshark åˆ†æTLSæ¡æ‰‹
# è¿‡æ»¤å™¨: tcp.port == 443 and ssl

# ä½¿ç”¨ curl è§‚å¯Ÿè¿æ¥è¿‡ç¨‹
curl -v https://www.example.com
```

### æµè§ˆå™¨å¼€å‘è€…å·¥å…·
```javascript
// åœ¨æ§åˆ¶å°æŸ¥çœ‹è¿æ¥æ—¶é—´
performance.getEntriesByType('navigation')[0]
/*
{
  domainLookupStart: 1.2,     // DNSå¼€å§‹
  domainLookupEnd: 45.3,      // DNSç»“æŸ
  connectStart: 45.4,         // TCPå¼€å§‹
  connectEnd: 78.9,           // TCPç»“æŸ
  secureConnectionStart: 46.1, // TLSå¼€å§‹
  requestStart: 79.2,         // è¯·æ±‚å¼€å§‹
  responseStart: 123.4        // å“åº”å¼€å§‹
}
*/
```

---

## ğŸ• å®Œæ•´ç½‘ç»œè¯·æ±‚æ—¶åºæµç¨‹è¯¦è§£

### ğŸ“Š å®Œæ•´ç½‘ç»œè¯·æ±‚ç”Ÿå‘½å‘¨æœŸæ—¶é—´çº¿

```
æ—¶é—´è½´ (æ¯«ç§’)
0ms     50ms    100ms   150ms   200ms   250ms   300ms   350ms
|-------|-------|-------|-------|-------|-------|-------|-------|
1.2ms   45.3ms  79.2ms  123.4ms 245.7ms 267.3ms 345.8ms
 ğŸŒ      ğŸ¤      ğŸ“¤      ğŸ“¥      âš™ï¸      ğŸ‘‹      ğŸ’”
DNS     TCP     è¯·æ±‚    å“åº”    å¤„ç†    æŒ¥æ‰‹    å…³é—­

å®Œæ•´7é˜¶æ®µæµç¨‹ï¼š
ğŸŒ DNSè§£æ     (1.2ms â†’ 45.3ms)   â† åŸŸåè½¬IP
ğŸ¤ TCP+TLSæ¡æ‰‹ (45.4ms â†’ 78.9ms)  â† å»ºç«‹å®‰å…¨è¿æ¥
ğŸ“¤ HTTPè¯·æ±‚    (79.2ms â†’ 123.4ms) â† å‘é€è¯·æ±‚
ğŸ“¥ HTTPå“åº”    (123.4ms â†’ 245.7ms)â† æ¥æ”¶æ•°æ®  
âš™ï¸ æ•°æ®å¤„ç†    (245.7ms â†’ 267.3ms)â† è§£æå¤„ç†
ğŸ‘‹ TCPæŒ¥æ‰‹     (267.3ms â†’ 345.8ms)â† å…³é—­è¿æ¥
ğŸ’” è¿æ¥å…³é—­    (345.8ms)          â† å®Œå…¨æ–­å¼€
```

### ğŸ” è¯¦ç»†æ—¶åºåˆ†æ

#### **é˜¶æ®µ1: DNSè§£æ (1.2ms â†’ 45.3msï¼Œè€—æ—¶44.1ms)**
```
ğŸŒ DNSè§£æé˜¶æ®µ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1.2ms                                 45.3ms
  â†“                                     â†“
å¼€å§‹DNSæŸ¥è¯¢                        DNSæŸ¥è¯¢å®Œæˆ
www.example.com â†’ 192.168.1.100

è¿‡ç¨‹è¯¦è§£ï¼š
1. æµè§ˆå™¨æ£€æŸ¥æœ¬åœ°DNSç¼“å­˜
2. æŸ¥è¯¢æ“ä½œç³»ç»ŸDNSç¼“å­˜  
3. å‘DNSæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢
4. é€’å½’æŸ¥è¯¢æ ¹æœåŠ¡å™¨ã€é¡¶çº§åŸŸæœåŠ¡å™¨
5. è·å¾—ç›®æ ‡IPåœ°å€ï¼š192.168.1.100
```

#### **é˜¶æ®µ2: TCPè¿æ¥å»ºç«‹ (45.4ms â†’ 78.9msï¼Œè€—æ—¶33.5ms)**
```
ğŸ¤ TCPä¸‰æ¬¡æ¡æ‰‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
45.4ms                      78.9ms
  â†“                           â†“
å¼€å§‹TCPè¿æ¥              TCPè¿æ¥å»ºç«‹

è¯¦ç»†æ¡æ‰‹è¿‡ç¨‹ï¼š
45.4ms  å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨: SYN
56.7ms  æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯: SYN-ACK  
78.9ms  å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨: ACK âœ…è¿æ¥å»ºç«‹
```

#### **é˜¶æ®µ3: TLSå®‰å…¨æ¡æ‰‹ (46.1ms â†’ 78.9msï¼Œè€—æ—¶32.8ms)**
```
ğŸ” TLSæ¡æ‰‹ (ä¸TCPå¹¶è¡Œè¿›è¡Œ)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
46.1ms                      78.9ms
  â†“                           â†“
å¼€å§‹TLSæ¡æ‰‹              TLSæ¡æ‰‹å®Œæˆ

TLSæ¡æ‰‹è¯¦ç»†è¿‡ç¨‹ï¼š
46.1ms  Client Hello (æ”¯æŒçš„åŠ å¯†å¥—ä»¶)
52.3ms  Server Hello + Certificate (é€‰æ‹©åŠ å¯†å¥—ä»¶+è¯ä¹¦)
65.7ms  Client Key Exchange (å¯†é’¥äº¤æ¢)
78.9ms  Finished âœ…å®‰å…¨è¿æ¥å»ºç«‹
```

#### **é˜¶æ®µ4: HTTPè¯·æ±‚å‘é€ (79.2ms â†’ 123.4msï¼Œè€—æ—¶44.2ms)**
```
ğŸ“¤ HTTPè¯·æ±‚é˜¶æ®µ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
79.2ms                              123.4ms
  â†“                                     â†“
å‘é€HTTPè¯·æ±‚                      æ”¶åˆ°å“åº”å¼€å§‹

HTTPè¯·æ±‚è¯¦è§£ï¼š
79.2ms  å‘é€è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“
95.8ms  è¯·æ±‚æ•°æ®ä¼ è¾“å®Œæˆ
108.6ms æœåŠ¡å™¨å¼€å§‹å¤„ç†è¯·æ±‚
123.4ms æœåŠ¡å™¨å¼€å§‹å‘é€å“åº”
```

#### **é˜¶æ®µ5: HTTPå“åº”æ¥æ”¶ (123.4ms â†’ 245.7msï¼Œè€—æ—¶122.3ms)**
```
ğŸ“¥ HTTPå“åº”é˜¶æ®µ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
123.4ms                                                                              245.7ms
   â†“                                                                                    â†“
å“åº”å¼€å§‹ä¼ è¾“                                                                      å“åº”æ¥æ”¶å®Œæˆ

HTTPå“åº”è¯¦è§£ï¼š
123.4ms  æœåŠ¡å™¨å¼€å§‹å‘é€å“åº”å¤´
145.8ms  å“åº”å¤´æ¥æ”¶å®Œæˆ
167.2ms  å“åº”ä½“å¼€å§‹ä¼ è¾“
201.5ms  ç¬¬ä¸€æ‰¹æ•°æ®å—åˆ°è¾¾ (è¿›åº¦20%)
223.9ms  å¤§éƒ¨åˆ†æ•°æ®ä¼ è¾“å®Œæˆ (è¿›åº¦80%)
245.7ms  å“åº”ä½“å®Œå…¨æ¥æ”¶å®Œæˆ âœ…
```

#### **é˜¶æ®µ6: æ•°æ®å¤„ç†é˜¶æ®µ (245.7ms â†’ 267.3msï¼Œè€—æ—¶21.6ms)**
```
âš™ï¸ å®¢æˆ·ç«¯æ•°æ®å¤„ç†
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
245.7ms                     267.3ms
   â†“                           â†“
å¼€å§‹å¤„ç†å“åº”              å¤„ç†å®Œæˆ

æ•°æ®å¤„ç†è¯¦è§£ï¼š
245.7ms  è§£æå“åº”å¤´ä¿¡æ¯ (Content-Type, Content-Lengthç­‰)
251.3ms  è§£å‹ç¼©å“åº”æ•°æ® (å¦‚æœä½¿ç”¨gzip/brotliå‹ç¼©)
258.9ms  JSONè§£ææˆ–HTMLè§£æ
264.1ms  DOMæ„å»ºæˆ–æ•°æ®å­˜å‚¨
267.3ms  å®¢æˆ·ç«¯å¤„ç†å®Œæˆ âœ…
```

#### **é˜¶æ®µ7: TCPè¿æ¥å…³é—­ (267.3ms â†’ 345.8msï¼Œè€—æ—¶78.5ms)**
```
ğŸ‘‹ TCPå››æ¬¡æŒ¥æ‰‹ (è¿æ¥å…³é—­)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
267.3ms      285.7ms      312.4ms      334.2ms      345.8ms
   â†“            â†“            â†“            â†“            â†“
å®¢æˆ·ç«¯FIN    æœåŠ¡å™¨ACK    æœåŠ¡å™¨FIN    å®¢æˆ·ç«¯ACK    è¿æ¥å…³é—­

å››æ¬¡æŒ¥æ‰‹è¯¦è§£ï¼š
267.3ms  å®¢æˆ·ç«¯å‘é€ FIN (æˆ‘è¦å…³é—­è¿æ¥äº†)
285.7ms  æœåŠ¡å™¨å‘é€ ACK (æ”¶åˆ°ï¼Œä½†æˆ‘è¿˜æœ‰æ•°æ®è¦å‘)
312.4ms  æœåŠ¡å™¨å‘é€ FIN (æˆ‘ä¹Ÿå‡†å¤‡å…³é—­äº†)
334.2ms  å®¢æˆ·ç«¯å‘é€ ACK (å¥½çš„ï¼Œå†è§)
345.8ms  è¿æ¥å®Œå…¨å…³é—­ ğŸ’” (TIME_WAITç»“æŸ)
```

### ğŸ¯ å…³é”®æ—¶é—´ç‚¹è§£é‡Š

```javascript
// å®Œæ•´ç½‘ç»œè¯·æ±‚ç”Ÿå‘½å‘¨æœŸåˆ†æå™¨
class CompleteNetworkTimingAnalyzer {
  analyzeTimings(perfEntry) {
    const phases = {
      // ğŸŒ DNSè§£æé˜¶æ®µ
      dnsLookup: {
        start: perfEntry.domainLookupStart,    // 1.2ms
        end: perfEntry.domainLookupEnd,        // 45.3ms
        duration: perfEntry.domainLookupEnd - perfEntry.domainLookupStart, // 44.1ms
        description: 'ğŸŒ DNSæŸ¥è¯¢ï¼šåŸŸåè½¬æ¢ä¸ºIPåœ°å€',
        icon: 'ğŸŒ'
      },
      
      // ğŸ¤ TCP+TLSè¿æ¥é˜¶æ®µ  
      connection: {
        start: perfEntry.connectStart,         // 45.4ms (DNSå®Œæˆåç«‹å³å¼€å§‹)
        end: perfEntry.connectEnd,             // 78.9ms
        duration: perfEntry.connectEnd - perfEntry.connectStart, // 33.5ms
        description: 'ğŸ¤ TCP+TLSæ¡æ‰‹ï¼šå»ºç«‹å®‰å…¨è¿æ¥',
        icon: 'ğŸ¤'
      },
      
      // ğŸ“¤ HTTPè¯·æ±‚å‘é€é˜¶æ®µ
      requestSending: {
        start: perfEntry.requestStart,         // 79.2ms (è¿æ¥å»ºç«‹å)
        end: perfEntry.responseStart,          // 123.4ms
        duration: perfEntry.responseStart - perfEntry.requestStart, // 44.2ms
        description: 'ğŸ“¤ HTTPè¯·æ±‚ï¼šå‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨',
        icon: 'ğŸ“¤'
      },
      
      // ğŸ“¥ HTTPå“åº”æ¥æ”¶é˜¶æ®µ
      responseReceiving: {
        start: perfEntry.responseStart,        // 123.4ms
        end: perfEntry.responseEnd,            // 245.7ms
        duration: perfEntry.responseEnd - perfEntry.responseStart, // 122.3ms
        description: 'ğŸ“¥ HTTPå“åº”ï¼šæ¥æ”¶æœåŠ¡å™¨æ•°æ®',
        icon: 'ğŸ“¥'
      },
      
      // âš™ï¸ æ•°æ®å¤„ç†é˜¶æ®µ
      dataProcessing: {
        start: perfEntry.responseEnd,          // 245.7ms
        end: perfEntry.loadEventStart || perfEntry.responseEnd + 21.6, // 267.3ms
        duration: 21.6, // ä¼°ç®—å€¼
        description: 'âš™ï¸ æ•°æ®å¤„ç†ï¼šè§£æå’Œå¤„ç†å“åº”',
        icon: 'âš™ï¸'
      },
      
      // ğŸ‘‹ è¿æ¥å…³é—­é˜¶æ®µ (ä¼°ç®—)
      connectionClosing: {
        start: perfEntry.loadEventStart || perfEntry.responseEnd + 21.6, // 267.3ms
        end: (perfEntry.loadEventStart || perfEntry.responseEnd + 21.6) + 78.5, // 345.8ms
        duration: 78.5, // ä¼°ç®—çš„å››æ¬¡æŒ¥æ‰‹æ—¶é—´
        description: 'ğŸ‘‹ TCPæŒ¥æ‰‹ï¼šä¼˜é›…å…³é—­è¿æ¥',
        icon: 'ğŸ‘‹'
      },
      
      // ğŸ’” è¿æ¥å®Œå…¨å…³é—­
      connectionClosed: {
        start: (perfEntry.loadEventStart || perfEntry.responseEnd + 21.6) + 78.5, // 345.8ms
        end: (perfEntry.loadEventStart || perfEntry.responseEnd + 21.6) + 78.5, // 345.8ms
        duration: 0,
        description: 'ğŸ’” è¿æ¥å…³é—­ï¼šç½‘ç»œè¯·æ±‚ç”Ÿå‘½å‘¨æœŸç»“æŸ',
        icon: 'ğŸ’”'
      }
    };
    
    return phases;
  }
  
  // ç”Ÿæˆå®Œæ•´å¯è§†åŒ–æ—¶é—´çº¿
  generateCompleteTimeline(phases) {
    console.log('ğŸ• å®Œæ•´ç½‘ç»œè¯·æ±‚ç”Ÿå‘½å‘¨æœŸæ—¶åºï¼š\n');
    
    // è®¡ç®—æ€»è€—æ—¶
    const totalTime = Math.max(...Object.values(phases).map(p => p.end));
    
    // ç”Ÿæˆæ—¶é—´è½´
    console.log(`æ€»è€—æ—¶: ${totalTime.toFixed(1)}ms\n`);
    console.log('æ—¶é—´è½´:');
    console.log('0ms     100ms   200ms   300ms   400ms');
    console.log('|-------|-------|-------|-------|');
    
    // æ˜¾ç¤ºæ¯ä¸ªé˜¶æ®µ
    Object.entries(phases).forEach(([name, phase]) => {
      if (phase.duration > 0) {
        const barLength = Math.max(1, Math.floor(phase.duration / 5));
        const bar = 'â–ˆ'.repeat(barLength);
        const percentage = ((phase.duration / totalTime) * 100).toFixed(1);
        
        console.log(`\n${phase.icon} ${phase.description}`);
        console.log(`   ${phase.start.toFixed(1)}ms â†’ ${phase.end.toFixed(1)}ms (${phase.duration.toFixed(1)}ms, ${percentage}%)`);
        console.log(`   ${bar}`);
      } else {
        console.log(`\n${phase.icon} ${phase.description}`);
        console.log(`   ${phase.start.toFixed(1)}ms (ç¬é—´å®Œæˆ)`);
      }
    });
    
    // æ€§èƒ½åˆ†æ
    this.analyzePerformance(phases, totalTime);
  }
  
  // æ€§èƒ½åˆ†æå’Œå»ºè®®
  analyzePerformance(phases, totalTime) {
    console.log('\nğŸ“Š æ€§èƒ½åˆ†æ:');
    
    // æ‰¾å‡ºæœ€è€—æ—¶çš„é˜¶æ®µ
    const sortedPhases = Object.entries(phases)
      .filter(([_, phase]) => phase.duration > 0)
      .sort(([_, a], [__, b]) => b.duration - a.duration);
    
    console.log('\nâ° è€—æ—¶æ’è¡Œ:');
    sortedPhases.slice(0, 3).forEach(([name, phase], index) => {
      const rank = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][index];
      const percentage = ((phase.duration / totalTime) * 100).toFixed(1);
      console.log(`${rank} ${phase.description}: ${phase.duration.toFixed(1)}ms (${percentage}%)`);
    });
    
    // æä¾›ä¼˜åŒ–å»ºè®®
    console.log('\nğŸ’¡ ä¼˜åŒ–å»ºè®®:');
    if (phases.dnsLookup.duration > 50) {
      console.log('- ğŸŒ DNSæŸ¥è¯¢è¾ƒæ…¢ï¼Œå»ºè®®ä½¿ç”¨DNSé¢„è§£ææˆ–CDN');
    }
    if (phases.connection.duration > 100) {
      console.log('- ğŸ¤ è¿æ¥å»ºç«‹è¾ƒæ…¢ï¼Œå»ºè®®ä½¿ç”¨è¿æ¥é¢„çƒ­æˆ–HTTP/2');
    }
    if (phases.responseReceiving.duration > 200) {
      console.log('- ğŸ“¥ å“åº”æ¥æ”¶è¾ƒæ…¢ï¼Œå»ºè®®å¯ç”¨å‹ç¼©æˆ–ä½¿ç”¨CDN');
    }
    if (totalTime > 500) {
      console.log('- âš¡ æ€»ä½“è¾ƒæ…¢ï¼Œå»ºè®®ç»¼åˆä¼˜åŒ–ç½‘ç»œå’ŒæœåŠ¡å™¨æ€§èƒ½');
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const completeAnalyzer = new CompleteNetworkTimingAnalyzer();
const timings = performance.getEntriesByType('navigation')[0];
const phases = completeAnalyzer.analyzeTimings(timings);
completeAnalyzer.generateCompleteTimeline(phases);

/* ç¤ºä¾‹è¾“å‡º:
ğŸ• å®Œæ•´ç½‘ç»œè¯·æ±‚ç”Ÿå‘½å‘¨æœŸæ—¶åºï¼š

æ€»è€—æ—¶: 345.8ms

æ—¶é—´è½´:
0ms     100ms   200ms   300ms   400ms
|-------|-------|-------|-------|

ğŸŒ DNSæŸ¥è¯¢ï¼šåŸŸåè½¬æ¢ä¸ºIPåœ°å€
   1.2ms â†’ 45.3ms (44.1ms, 12.7%)
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

ğŸ¤ TCP+TLSæ¡æ‰‹ï¼šå»ºç«‹å®‰å…¨è¿æ¥
   45.4ms â†’ 78.9ms (33.5ms, 9.7%)
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

ğŸ“¤ HTTPè¯·æ±‚ï¼šå‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨
   79.2ms â†’ 123.4ms (44.2ms, 12.8%)
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

ğŸ“¥ HTTPå“åº”ï¼šæ¥æ”¶æœåŠ¡å™¨æ•°æ®
   123.4ms â†’ 245.7ms (122.3ms, 35.4%)
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

âš™ï¸ æ•°æ®å¤„ç†ï¼šè§£æå’Œå¤„ç†å“åº”
   245.7ms â†’ 267.3ms (21.6ms, 6.2%)
   â–ˆâ–ˆâ–ˆâ–ˆ

ğŸ‘‹ TCPæŒ¥æ‰‹ï¼šä¼˜é›…å…³é—­è¿æ¥
   267.3ms â†’ 345.8ms (78.5ms, 22.7%)
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

ğŸ’” è¿æ¥å…³é—­ï¼šç½‘ç»œè¯·æ±‚ç”Ÿå‘½å‘¨æœŸç»“æŸ
   345.8ms (ç¬é—´å®Œæˆ)

ğŸ“Š æ€§èƒ½åˆ†æ:

â° è€—æ—¶æ’è¡Œ:
ğŸ¥‡ ğŸ“¥ HTTPå“åº”ï¼šæ¥æ”¶æœåŠ¡å™¨æ•°æ®: 122.3ms (35.4%)
ğŸ¥ˆ ğŸ‘‹ TCPæŒ¥æ‰‹ï¼šä¼˜é›…å…³é—­è¿æ¥: 78.5ms (22.7%)
ğŸ¥‰ ğŸŒ DNSæŸ¥è¯¢ï¼šåŸŸåè½¬æ¢ä¸ºIPåœ°å€: 44.1ms (12.7%)

ğŸ’¡ ä¼˜åŒ–å»ºè®®:
- ğŸ“¥ å“åº”æ¥æ”¶è¾ƒæ…¢ï¼Œå»ºè®®å¯ç”¨å‹ç¼©æˆ–ä½¿ç”¨CDN
*/
```

### ğŸ¤” ä¸ºä»€ä¹ˆæ—¶é—´ä¼šé‡å ï¼Ÿ

**å…³é”®ç†è§£ï¼šæŸäº›é˜¶æ®µå¯ä»¥å¹¶è¡Œè¿›è¡Œ**

```
é”™è¯¯ç†è§£ âŒ (è®¤ä¸ºå®Œå…¨ä¸²è¡Œ)ï¼š
DNS â†’ TCP â†’ TLS â†’ è¯·æ±‚ â†’ å“åº” â†’ å¤„ç† â†’ å…³é—­

æ­£ç¡®ç†è§£ âœ… (å®Œæ•´çš„7é˜¶æ®µæµç¨‹)ï¼š

1ï¸âƒ£ DNSè§£æ     (1.2ms â†’ 45.3ms)    44.1ms  ğŸŒ
                â†“
2ï¸âƒ£ TCP+TLSæ¡æ‰‹ (45.4ms â†’ 78.9ms)   33.5ms  ğŸ¤ (TLSåœ¨TCPæœŸé—´å¹¶è¡Œ)
                â†“
3ï¸âƒ£ HTTPè¯·æ±‚    (79.2ms â†’ 123.4ms)  44.2ms  ğŸ“¤
                â†“
4ï¸âƒ£ HTTPå“åº”    (123.4ms â†’ 245.7ms) 122.3ms ğŸ“¥ (æœ€è€—æ—¶é˜¶æ®µ)
                â†“
5ï¸âƒ£ æ•°æ®å¤„ç†    (245.7ms â†’ 267.3ms) 21.6ms  âš™ï¸
                â†“
6ï¸âƒ£ TCPæŒ¥æ‰‹     (267.3ms â†’ 345.8ms) 78.5ms  ğŸ‘‹ (å››æ¬¡æŒ¥æ‰‹)
                â†“
7ï¸âƒ£ è¿æ¥å…³é—­    (345.8ms)           0ms     ğŸ’”

å…³é”®æ—¶åºç‰¹ç‚¹ï¼š
- DNSå¿…é¡»å®Œæˆæ‰èƒ½è·å¾—IPåœ°å€
- TCPå’ŒTLSå¯ä»¥å¹¶è¡Œæ¡æ‰‹ï¼ˆç°ä»£ä¼˜åŒ–ï¼‰
- HTTPå“åº”é€šå¸¸æ˜¯æœ€è€—æ—¶çš„é˜¶æ®µ
- TCPæŒ¥æ‰‹å¯èƒ½æ¯”å»ºç«‹è¿æ¥æ›´è€—æ—¶ï¼ˆéœ€è¦ç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼‰
- æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæ€»è€—æ—¶ï¼š345.8ms
```

### ğŸ¯ ä¼˜åŒ–å»ºè®®

```javascript
// åŸºäºæ—¶åºåˆ†æçš„ä¼˜åŒ–ç­–ç•¥
class NetworkOptimizationSuggestions {
  analyzePerfBottlenecks(phases) {
    const suggestions = [];
    
    // DNSä¼˜åŒ–
    if (phases.dnsLookup.duration > 30) {
      suggestions.push({
        phase: 'DNS',
        issue: `DNSæŸ¥è¯¢è€—æ—¶${phases.dnsLookup.duration}msï¼Œè¾ƒæ…¢`,
        solutions: [
          'ä½¿ç”¨DNSé¢„è§£æ: <link rel="dns-prefetch" href="//api.example.com">',
          'é…ç½®æ›´å¿«çš„DNSæœåŠ¡å™¨ (å¦‚8.8.8.8)',
          'ä½¿ç”¨CDNå‡å°‘DNSæŸ¥è¯¢'
        ]
      });
    }
    
    // TCPè¿æ¥ä¼˜åŒ–
    if (phases.tcpConnection.duration > 50) {
      suggestions.push({
        phase: 'TCP',
        issue: `TCPè¿æ¥è€—æ—¶${phases.tcpConnection.duration}msï¼Œè¾ƒæ…¢`,
        solutions: [
          'ä½¿ç”¨è¿æ¥é¢„çƒ­: <link rel="preconnect" href="https://api.example.com">',
          'å¯ç”¨HTTP/2å¤šè·¯å¤ç”¨',
          'ä½¿ç”¨CDNè¾¹ç¼˜èŠ‚ç‚¹'
        ]
      });
    }
    
    // TLSä¼˜åŒ–
    if (phases.tlsHandshake.duration > 40) {
      suggestions.push({
        phase: 'TLS',
        issue: `TLSæ¡æ‰‹è€—æ—¶${phases.tlsHandshake.duration}msï¼Œè¾ƒæ…¢`,
        solutions: [
          'å¯ç”¨TLSä¼šè¯å¤ç”¨',
          'ä½¿ç”¨OCSP Stapling',
          'å‡çº§åˆ°TLS 1.3'
        ]
      });
    }
    
    return suggestions;
  }
}
```

### ğŸ“± ä¸åŒåœºæ™¯ä¸‹çš„æ—¶åºç‰¹ç‚¹

```javascript
// ä¸åŒç½‘ç»œç¯å¢ƒçš„å…¸å‹è€—æ—¶
const typicalTimings = {
  // ğŸ  å®¶åº­WiFi
  homeWiFi: {
    dns: '10-30ms',
    tcp: '20-50ms', 
    tls: '30-60ms',
    request: '50-200ms'
  },
  
  // ğŸ“± 4Gç§»åŠ¨ç½‘ç»œ
  mobile4G: {
    dns: '50-150ms',
    tcp: '100-300ms',
    tls: '150-400ms', 
    request: '200-800ms'
  },
  
  // ğŸŒ ä¼ä¸šå†…ç½‘
  corporate: {
    dns: '5-15ms',
    tcp: '10-30ms',
    tls: '20-40ms',
    request: '20-100ms'
  }
};
```

---

## ğŸ“ å­¦ä¹ æ€»ç»“

### ğŸ”‘ æ ¸å¿ƒè¦ç‚¹å›é¡¾

**ğŸŒ å®Œæ•´ç½‘ç»œè¯·æ±‚ç”Ÿå‘½å‘¨æœŸ (7ä¸ªé˜¶æ®µ)**
1. **DNSè§£æ** â†’ åŸŸåè½¬IPåœ°å€
2. **TCP+TLSæ¡æ‰‹** â†’ å»ºç«‹å®‰å…¨è¿æ¥  
3. **HTTPè¯·æ±‚** â†’ å‘é€æ•°æ®åˆ°æœåŠ¡å™¨
4. **HTTPå“åº”** â†’ æ¥æ”¶æœåŠ¡å™¨æ•°æ® (é€šå¸¸æœ€è€—æ—¶)
5. **æ•°æ®å¤„ç†** â†’ å®¢æˆ·ç«¯è§£æå¤„ç†
6. **TCPæŒ¥æ‰‹** â†’ å››æ¬¡æŒ¥æ‰‹å…³é—­è¿æ¥
7. **è¿æ¥å…³é—­** â†’ èµ„æºé‡Šæ”¾å®Œæˆ

### ğŸ“Š æ€§èƒ½ä¼˜åŒ–é‡ç‚¹

**åŸºäºçœŸå®æ•°æ®çš„ä¼˜åŒ–ç­–ç•¥**ï¼š
- ğŸ¥‡ **HTTPå“åº”ä¼˜åŒ–** (35.4%è€—æ—¶) â†’ å‹ç¼©ã€CDNã€ç¼“å­˜
- ğŸ¥ˆ **TCPæŒ¥æ‰‹ä¼˜åŒ–** (22.7%è€—æ—¶) â†’ Keep-Aliveã€è¿æ¥å¤ç”¨  
- ğŸ¥‰ **DNSæŸ¥è¯¢ä¼˜åŒ–** (12.7%è€—æ—¶) â†’ é¢„è§£æã€DNSç¼“å­˜

### ğŸ¯ è®°å¿†æŠ€å·§

**æƒ…æ™¯å‰§è®°å¿†æ³•**ï¼š
- TCPæ¡æ‰‹ = ç”µè¯é€šè¯å»ºç«‹
- TLSæ¡æ‰‹ = é—´è°æš—å·äº¤æ¢  
- TCPæŒ¥æ‰‹ = ç”µè¯ç¤¼è²ŒæŒ‚æœº

**æ—¶åºè®°å¿†å£è¯€**ï¼š
```
DNSå…ˆæŸ¥åœ°å€åœ¨å“ªé‡Œ â†’ ğŸŒ
TCPæ¡æ‰‹è¯´ä½ å¥½     â†’ ğŸ¤  
HTTPè¯·æ±‚å‘æ•°æ®    â†’ ğŸ“¤
HTTPå“åº”æ”¶å›æ¥    â†’ ğŸ“¥
æ•°æ®å¤„ç†è¦è§£æ    â†’ âš™ï¸
TCPæŒ¥æ‰‹è¯´å†è§     â†’ ğŸ‘‹
è¿æ¥å…³é—­å…¨ç»“æŸ    â†’ ğŸ’”
```

### ğŸ› ï¸ å®ç”¨å·¥å…·

**æµè§ˆå™¨å¼€å‘è€…å·¥å…·**ï¼š
```javascript
// æŸ¥çœ‹å®Œæ•´æ—¶åº
performance.getEntriesByType('navigation')[0]

// ä½¿ç”¨æˆ‘ä»¬çš„åˆ†æå™¨
const analyzer = new CompleteNetworkTimingAnalyzer();
const phases = analyzer.analyzeTimings(timings);
analyzer.generateCompleteTimeline(phases);
```

**æŠ“åŒ…åˆ†æå·¥å…·**ï¼š
- `tcpdump` â†’ TCPå±‚åˆ†æ
- `wireshark` â†’ å…¨åè®®æ ˆåˆ†æ
- `curl -v` â†’ HTTPå±‚è§‚å¯Ÿ

### ğŸ’¡ æ·±åº¦ç†è§£

**å¹¶è¡Œä¼˜åŒ–åŸç†**ï¼š
- ç°ä»£æµè§ˆå™¨æ”¯æŒTCPå’ŒTLSå¹¶è¡Œæ¡æ‰‹
- HTTP/2å®ç°å¤šè·¯å¤ç”¨ï¼Œå‡å°‘è¿æ¥å¼€é”€
- DNSé¢„è§£æå¯ä»¥æå‰è¿›è¡ŒåŸŸåæŸ¥è¯¢

**æ€§èƒ½ç“¶é¢ˆè¯†åˆ«**ï¼š
- DNS > 50ms â†’ è€ƒè™‘DNSä¼˜åŒ–
- è¿æ¥ > 100ms â†’ è€ƒè™‘ç½‘ç»œä¼˜åŒ–  
- å“åº” > 200ms â†’ è€ƒè™‘æœåŠ¡å™¨/CDNä¼˜åŒ–
- æ€»è®¡ > 500ms â†’ éœ€è¦ç»¼åˆä¼˜åŒ–

è¿™æ ·çš„è®²è§£æ–¹å¼ç»“åˆäº†ï¼š
- ğŸ­ **æƒ…æ™¯å‰§è®°å¿†æ³•**ï¼šè®©æŠ½è±¡çš„ç½‘ç»œåè®®å˜æˆç”ŸåŠ¨çš„å¯¹è¯
- ğŸ“Š **å¯è§†åŒ–å›¾è¡¨**ï¼šæ¸…æ™°å±•ç¤ºæ¯ä¸ªæ­¥éª¤çš„æ—¶åº
- ğŸ’» **ä»£ç æ¨¡æ‹Ÿ**ï¼šé€šè¿‡ä»£ç åŠ æ·±ç†è§£
- ğŸ¯ **è®°å¿†å£è¯€**ï¼šç®€åŒ–å¤æ‚æ¦‚å¿µ
- ğŸ› ï¸ **å®ç”¨å·¥å…·**ï¼šæä¾›è°ƒè¯•å’ŒéªŒè¯æ–¹æ³•
- ğŸ“ˆ **æ•°æ®åˆ†æ**ï¼šåŸºäºçœŸå®æ€§èƒ½æ•°æ®æä¾›ä¼˜åŒ–å»ºè®®

è®©å¤æ‚çš„ç½‘ç»œåŸç†å˜å¾—å®¹æ˜“ç†è§£ã€è®°å¿†å’Œå®é™…åº”ç”¨ï¼ğŸš€

---

## ğŸš„ HTTP/2 å¤šè·¯å¤ç”¨åœºæ™¯

> **é©å‘½æ€§å˜åŒ–**ï¼šä¸€ä¸ªTCPè¿æ¥å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªHTTPè¯·æ±‚ï¼Œå½»åº•æ”¹å˜äº†ç½‘ç»œè¯·æ±‚çš„æ—¶åºæ¨¡å¼ï¼

### ğŸ“Š HTTP/1.1 vs HTTP/2 å¯¹æ¯”

```
HTTP/1.1 ä¼ ç»Ÿæ¨¡å¼ (éœ€è¦å¤šä¸ªè¿æ¥)ï¼š
è¿æ¥1: DNS â†’ TCP â†’ TLS â†’ è¯·æ±‚A â†’ å“åº”A â†’ æŒ¥æ‰‹ 
è¿æ¥2: DNS â†’ TCP â†’ TLS â†’ è¯·æ±‚B â†’ å“åº”B â†’ æŒ¥æ‰‹
è¿æ¥3: DNS â†’ TCP â†’ TLS â†’ è¯·æ±‚C â†’ å“åº”C â†’ æŒ¥æ‰‹
æ€»è€—æ—¶: 3 Ã— å®Œæ•´ç”Ÿå‘½å‘¨æœŸ â‰ˆ 1000ms+

HTTP/2 å¤šè·¯å¤ç”¨æ¨¡å¼ (å•ä¸ªè¿æ¥)ï¼š
è¿æ¥1: DNS â†’ TCP â†’ TLS â†’ [è¯·æ±‚A+B+Cå¹¶è¡Œ] â†’ [å“åº”A+B+Cå¹¶è¡Œ] â†’ æŒ¥æ‰‹
æ€»è€—æ—¶: 1 Ã— å»ºç«‹ + å¹¶è¡Œè¯·æ±‚ â‰ˆ 400ms
```

### ğŸ¯ HTTP/2 å¤šè·¯å¤ç”¨æ—¶åºè¯¦è§£

```
ğŸš„ HTTP/2 å¤šè·¯å¤ç”¨å®Œæ•´æ—¶åº (åŒæ—¶å¤„ç†3ä¸ªè¯·æ±‚)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ—¶é—´è½´ (æ¯«ç§’)
0ms     50ms    100ms   150ms   200ms   250ms   300ms   350ms   400ms
|-------|-------|-------|-------|-------|-------|-------|-------|-------|

é˜¶æ®µ1: è¿æ¥å»ºç«‹ (ä¸€æ¬¡æ€§å®Œæˆ)
1.2ms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º 78.9ms
ğŸŒDNSè§£æ â†’ ğŸ¤TCP+TLSæ¡æ‰‹ (77.7ms)

é˜¶æ®µ2: å¤šè·¯å¤ç”¨è¯·æ±‚/å“åº” (å¹¶è¡Œå¤„ç†)
79.2ms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º 267.3ms

Stream 1 (APIè¯·æ±‚):   ğŸ“¤â•â•â•â•â•â•â•â•â•â•â•â–º ğŸ“¥â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º âš™ï¸ 
Stream 2 (å›¾ç‰‡è¯·æ±‚):  ğŸ“¤â•â•â•â•â•â•â•â•â•â•â•â–º ğŸ“¥â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º âš™ï¸
Stream 3 (CSSè¯·æ±‚):   ğŸ“¤â•â•â•â•â•â•â•â–º ğŸ“¥â•â•â•â•â•â•â•â•â•â•â•â–º âš™ï¸

79.2ms  â”‚  95.7ms  â”‚  123.4ms     â”‚     189.6ms    â”‚    245.7ms   â”‚ 267.3ms
å¼€å§‹    â”‚  è¯·æ±‚    â”‚  å“åº”å¼€å§‹    â”‚     å“åº”è¿›è¡Œ   â”‚    å“åº”å®Œæˆ  â”‚ å¤„ç†å®Œæˆ
å¤šè·¯å¤ç”¨â”‚  å…¨éƒ¨å‘é€â”‚              â”‚                â”‚              â”‚

é˜¶æ®µ3: è¿æ¥å…³é—­ (ä¸€æ¬¡æ€§å®Œæˆ)
267.3ms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º 345.8ms
ğŸ‘‹TCPå››æ¬¡æŒ¥æ‰‹ â†’ ğŸ’”è¿æ¥å…³é—­ (78.5ms)

æ€»è€—æ—¶: 345.8ms (ç›¸æ¯”HTTP/1.1èŠ‚çœ60%+æ—¶é—´)
```

### ğŸ’» HTTP/2 å¤šè·¯å¤ç”¨ä»£ç æ¨¡æ‹Ÿ

```javascript
// HTTP/2 å¤šè·¯å¤ç”¨æ—¶åºåˆ†æå™¨
class HTTP2MultiplexAnalyzer {
  constructor() {
    this.streams = new Map();
    this.connectionPhases = {
      establishment: null,
      multiplexing: null,
      closing: null
    };
  }

  // åˆ†æHTTP/2å¤šè·¯å¤ç”¨æ—¶åº
  analyzeHTTP2Timing(perfEntries) {
    // æ‰¾åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚ä½œä¸ºè¿æ¥å»ºç«‹åŸºå‡†
    const firstRequest = perfEntries[0];
    
    // è¿æ¥å»ºç«‹é˜¶æ®µ (åªéœ€è¦ä¸€æ¬¡)
    this.connectionPhases.establishment = {
      start: firstRequest.domainLookupStart,     // 1.2ms
      end: firstRequest.connectEnd,              // 78.9ms  
      duration: firstRequest.connectEnd - firstRequest.domainLookupStart, // 77.7ms
      description: 'ğŸŒğŸ¤ è¿æ¥å»ºç«‹ï¼šDNS + TCP + TLS (ä¸€æ¬¡æ€§)',
      icon: 'ğŸŒğŸ¤'
    };

    // å¤šè·¯å¤ç”¨é˜¶æ®µ (æ‰€æœ‰è¯·æ±‚å¹¶è¡Œ)
    const multiplexStart = Math.min(...perfEntries.map(e => e.requestStart));
    const multiplexEnd = Math.max(...perfEntries.map(e => e.responseEnd));
    
    this.connectionPhases.multiplexing = {
      start: multiplexStart,                     // 79.2ms
      end: multiplexEnd,                         // 267.3ms
      duration: multiplexEnd - multiplexStart,  // 188.1ms
      description: 'ğŸš„ å¤šè·¯å¤ç”¨ï¼šå¹¶è¡Œå¤„ç†æ‰€æœ‰è¯·æ±‚',
      icon: 'ğŸš„',
      streamCount: perfEntries.length
    };

    // åˆ†ææ¯ä¸ªStream
    perfEntries.forEach((entry, index) => {
      this.streams.set(`stream_${index + 1}`, {
        id: index + 1,
        url: entry.name,
        requestStart: entry.requestStart,
        responseStart: entry.responseStart, 
        responseEnd: entry.responseEnd,
        duration: entry.responseEnd - entry.requestStart,
        type: this.getRequestType(entry.name)
      });
    });

    // è¿æ¥å…³é—­é˜¶æ®µ (ä¸€æ¬¡æ€§)
    this.connectionPhases.closing = {
      start: multiplexEnd,                       // 267.3ms
      end: multiplexEnd + 78.5,                  // 345.8ms
      duration: 78.5, // ä¼°ç®—å€¼
      description: 'ğŸ‘‹ğŸ’” è¿æ¥å…³é—­ï¼šTCPæŒ¥æ‰‹ + èµ„æºé‡Šæ”¾',
      icon: 'ğŸ‘‹ğŸ’”'
    };

    return {
      connectionPhases: this.connectionPhases,
      streams: this.streams,
      totalTime: this.connectionPhases.closing.end,
      efficiency: this.calculateEfficiency(perfEntries)
    };
  }

  // åˆ¤æ–­è¯·æ±‚ç±»å‹
  getRequestType(url) {
    if (url.includes('.css')) return 'CSS';
    if (url.includes('.js')) return 'JavaScript';
    if (url.includes('.png') || url.includes('.jpg')) return 'Image';
    if (url.includes('/api/')) return 'API';
    return 'Document';
  }

  // è®¡ç®—å¤šè·¯å¤ç”¨æ•ˆç‡
  calculateEfficiency(perfEntries) {
    // HTTP/1.1ä¼°ç®—è€—æ—¶ (æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦å®Œæ•´è¿æ¥)
    const http1EstimatedTime = perfEntries.length * 345.8;
    
    // HTTP/2å®é™…è€—æ—¶
    const http2ActualTime = this.connectionPhases.closing.end;
    
    const timeSaved = http1EstimatedTime - http2ActualTime;
    const efficiencyGain = (timeSaved / http1EstimatedTime * 100).toFixed(1);
    
    return {
      http1EstimatedTime,
      http2ActualTime,
      timeSaved,
      efficiencyGain: `${efficiencyGain}%`
    };
  }

  // ç”ŸæˆHTTP/2å¯è§†åŒ–æ—¶åº
  generateHTTP2Timeline() {
    console.log('ğŸš„ HTTP/2 å¤šè·¯å¤ç”¨æ—¶åºåˆ†æ\n');
    
    const { connectionPhases, streams, totalTime, efficiency } = 
      this.analyzeHTTP2Timing([
        // æ¨¡æ‹Ÿå¤šä¸ªè¯·æ±‚çš„æ€§èƒ½æ•°æ®
        { domainLookupStart: 1.2, connectEnd: 78.9, requestStart: 79.2, responseStart: 123.4, responseEnd: 187.6, name: '/api/user' },
        { domainLookupStart: 1.2, connectEnd: 78.9, requestStart: 83.1, responseStart: 98.7, responseEnd: 234.5, name: '/static/style.css' },
        { domainLookupStart: 1.2, connectEnd: 78.9, requestStart: 85.4, responseStart: 145.2, responseEnd: 267.3, name: '/images/logo.png' }
      ]);

    // æ˜¾ç¤ºè¿æ¥é˜¶æ®µ
    console.log('ğŸ“Š è¿æ¥ç”Ÿå‘½å‘¨æœŸ:');
    Object.entries(connectionPhases).forEach(([phase, data]) => {
      if (data.streamCount) {
        console.log(`${data.icon} ${data.description} (${data.streamCount} streams)`);
      } else {
        console.log(`${data.icon} ${data.description}`);
      }
      console.log(`   ${data.start.toFixed(1)}ms â†’ ${data.end.toFixed(1)}ms (${data.duration.toFixed(1)}ms)\n`);
    });

    // æ˜¾ç¤ºStreamè¯¦æƒ…  
    console.log('ğŸŒŠ Stream è¯¦ç»†åˆ†æ:');
    streams.forEach((stream, key) => {
      const parallelStart = stream.requestStart - connectionPhases.multiplexing.start;
      const parallelEnd = stream.responseEnd - connectionPhases.multiplexing.start;
      
      console.log(`Stream ${stream.id} [${stream.type}]:`);
      console.log(`   URL: ${stream.url}`);
      console.log(`   å¹¶è¡Œæ—¶åº: +${parallelStart.toFixed(1)}ms â†’ +${parallelEnd.toFixed(1)}ms`);
      console.log(`   æŒç»­æ—¶é—´: ${stream.duration.toFixed(1)}ms\n`);
    });

    // æ•ˆç‡å¯¹æ¯”
    console.log('âš¡ æ€§èƒ½å¯¹æ¯”:');
    console.log(`HTTP/1.1 ä¼°ç®—è€—æ—¶: ${efficiency.http1EstimatedTime.toFixed(1)}ms`);
    console.log(`HTTP/2 å®é™…è€—æ—¶: ${efficiency.http2ActualTime.toFixed(1)}ms`);
    console.log(`èŠ‚çœæ—¶é—´: ${efficiency.timeSaved.toFixed(1)}ms`);
    console.log(`æ•ˆç‡æå‡: ${efficiency.efficiencyGain} ğŸš€`);

    return { connectionPhases, streams, efficiency };
  }

  // HTTP/2 æµæ§åˆ¶æ¨¡æ‹Ÿ
  simulateFlowControl() {
    console.log('\nğŸ›ï¸ HTTP/2 æµæ§åˆ¶ç‰¹æ€§:\n');
    
    console.log('1ï¸âƒ£ æµä¼˜å…ˆçº§ (Stream Priority):');
    console.log('   CSSæ–‡ä»¶     â†’ ä¼˜å…ˆçº§: é«˜   (weight: 256)');
    console.log('   APIè¯·æ±‚     â†’ ä¼˜å…ˆçº§: ä¸­   (weight: 128)'); 
    console.log('   å›¾ç‰‡èµ„æº    â†’ ä¼˜å…ˆçº§: ä½   (weight: 64)\n');
    
    console.log('2ï¸âƒ£ æœåŠ¡å™¨æ¨é€ (Server Push):');
    console.log('   è¯·æ±‚ index.html â†’ æœåŠ¡å™¨ä¸»åŠ¨æ¨é€ style.css');
    console.log('   èŠ‚çœä¸€ä¸ªRTTï¼Œæå‰åŠ è½½å…³é”®èµ„æº\n');
    
    console.log('3ï¸âƒ£ å¤´éƒ¨å‹ç¼© (HPACK):');
    console.log('   ç¬¬ä¸€ä¸ªè¯·æ±‚: å®Œæ•´å¤´éƒ¨ (500 bytes)');
    console.log('   åç»­è¯·æ±‚: å‹ç¼©å¤´éƒ¨ (50 bytes) â†’ èŠ‚çœ90%');
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const http2Analyzer = new HTTP2MultiplexAnalyzer();
const result = http2Analyzer.generateHTTP2Timeline();
http2Analyzer.simulateFlowControl();

/* ç¤ºä¾‹è¾“å‡º:
ğŸš„ HTTP/2 å¤šè·¯å¤ç”¨æ—¶åºåˆ†æ

ğŸ“Š è¿æ¥ç”Ÿå‘½å‘¨æœŸ:
ğŸŒğŸ¤ è¿æ¥å»ºç«‹ï¼šDNS + TCP + TLS (ä¸€æ¬¡æ€§)
   1.2ms â†’ 78.9ms (77.7ms)

ğŸš„ å¤šè·¯å¤ç”¨ï¼šå¹¶è¡Œå¤„ç†æ‰€æœ‰è¯·æ±‚ (3 streams)
   79.2ms â†’ 267.3ms (188.1ms)

ğŸ‘‹ğŸ’” è¿æ¥å…³é—­ï¼šTCPæŒ¥æ‰‹ + èµ„æºé‡Šæ”¾
   267.3ms â†’ 345.8ms (78.5ms)

ğŸŒŠ Stream è¯¦ç»†åˆ†æ:
Stream 1 [API]:
   URL: /api/user
   å¹¶è¡Œæ—¶åº: +0.0ms â†’ +108.4ms
   æŒç»­æ—¶é—´: 108.4ms

Stream 2 [CSS]:
   URL: /static/style.css  
   å¹¶è¡Œæ—¶åº: +3.9ms â†’ +155.3ms
   æŒç»­æ—¶é—´: 151.4ms

Stream 3 [Image]:
   URL: /images/logo.png
   å¹¶è¡Œæ—¶åº: +6.2ms â†’ +188.1ms
   æŒç»­æ—¶é—´: 181.9ms

âš¡ æ€§èƒ½å¯¹æ¯”:
HTTP/1.1 ä¼°ç®—è€—æ—¶: 1037.4ms
HTTP/2 å®é™…è€—æ—¶: 345.8ms  
èŠ‚çœæ—¶é—´: 691.6ms
æ•ˆç‡æå‡: 66.7% ğŸš€
*/
```

### ğŸ¯ HTTP/2 å¤šè·¯å¤ç”¨å…³é”®ä¼˜åŠ¿

**ğŸš€ æ€§èƒ½æå‡**ï¼š
- **è¿æ¥å¤ç”¨**ï¼šä¸€ä¸ªTCPè¿æ¥å¤„ç†æ‰€æœ‰è¯·æ±‚
- **å¹¶è¡Œä¼ è¾“**ï¼šå¤šä¸ªè¯·æ±‚åŒæ—¶è¿›è¡Œï¼Œä¸éœ€è¦ç­‰å¾…
- **å¤´éƒ¨å‹ç¼©**ï¼šHPACKç®—æ³•å‡å°‘90%å¤´éƒ¨å¼€é”€
- **æœåŠ¡å™¨æ¨é€**ï¼šæå‰æ¨é€å…³é”®èµ„æº

**â±ï¸ æ—¶åºä¼˜åŒ–**ï¼š
- **æ¶ˆé™¤é˜Ÿå¤´é˜»å¡**ï¼šHTTP/1.1çš„ä¸²è¡Œé™åˆ¶è¢«æ‰“ç ´
- **å‡å°‘è¿æ¥å¼€é”€**ï¼šDNS + TCP + TLSåªéœ€è¦ä¸€æ¬¡
- **æ™ºèƒ½æµæ§åˆ¶**ï¼šæ ¹æ®ä¼˜å…ˆçº§åˆ†é…å¸¦å®½èµ„æº

**ğŸ“Š å®é™…æ•ˆæœ**ï¼š
- **èŠ‚çœæ—¶é—´**ï¼šé€šå¸¸å¯ä»¥èŠ‚çœ60-80%çš„åŠ è½½æ—¶é—´
- **å‡å°‘èµ„æºæ¶ˆè€—**ï¼šæ›´å°‘çš„TCPè¿æ¥ï¼Œé™ä½æœåŠ¡å™¨è´Ÿè½½
- **æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ**ï¼šé¡µé¢åŠ è½½æ›´å¿«ï¼Œäº¤äº’æ›´æµç•…

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆHTTP/2è¢«ç§°ä¸ºç½‘ç»œæ€§èƒ½çš„é©å‘½æ€§å‡çº§ï¼ğŸš€

---

## ğŸ• æ—¶é—´é”™å¼€çš„å¤šè·¯å¤ç”¨åœºæ™¯

> **é‡è¦ç†è§£**ï¼šHTTP/2å¤šè·¯å¤ç”¨ä¸è¦æ±‚è¯·æ±‚åŒæ—¶å‘èµ·ï¼å³ä½¿è¯·æ±‚Aå‘é€2ç§’åæ‰å‘é€è¯·æ±‚Bï¼Œä¾ç„¶å¯ä»¥åœ¨åŒä¸€ä¸ªè¿æ¥ä¸Šå¹¶è¡Œå¤„ç†ã€‚

### ğŸ¯ æ—¶é—´é”™å¼€è¯·æ±‚çš„å®é™…åœºæ™¯

```
çœŸå®åœºæ™¯ï¼šç”¨æˆ·æµè§ˆç½‘é¡µçš„äº¤äº’æ—¶åº
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ—¶é—´è½´ (ç§’)
0s      1s      2s      3s      4s      5s      6s      7s      8s
|-------|-------|-------|-------|-------|-------|-------|-------|

0.0s: å»ºç«‹HTTP/2è¿æ¥
ğŸŒğŸ¤ DNS + TCP + TLS æ¡æ‰‹å®Œæˆ

0.5s: ç”¨æˆ·æ‰“å¼€é¡µé¢
ğŸ“¤ è¯·æ±‚A: GET /index.html â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ğŸ“¥ å“åº”A (0.8så®Œæˆ)

2.3s: ç”¨æˆ·ç‚¹å‡»æŒ‰é’® (å¼‚æ­¥Ajax)
ğŸ“¤ è¯·æ±‚B: POST /api/login â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ğŸ“¥ å“åº”B (2.7så®Œæˆ)
      â†‘                               â†‘
   æ–°è¯·æ±‚åœ¨Aå®Œæˆåæ‰å‘èµ·            Bå’ŒCå¯ä»¥å¹¶è¡Œå¤„ç†

4.1s: ç”¨æˆ·æ»šåŠ¨é¡µé¢ (æ‡’åŠ è½½å›¾ç‰‡)
ğŸ“¤ è¯·æ±‚C: GET /images/photo.jpg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ğŸ“¥ å“åº”C (6.2så®Œæˆ)

5.5s: ç”¨æˆ·å†æ¬¡äº¤äº’
ğŸ“¤ è¯·æ±‚D: GET /api/data â”€â”€â”€â”€â”€â”€â–º ğŸ“¥ å“åº”D (6.0så®Œæˆ)
                                  â†‘
                            Då’ŒCåŒæ—¶åœ¨ä¼ è¾“

å…³é”®ç‚¹ï¼š
âœ… åŒä¸€ä¸ªTCPè¿æ¥æŒç»­ä½¿ç”¨ (Keep-Alive)
âœ… æ–°è¯·æ±‚å¯ä»¥éšæ—¶åœ¨ç°æœ‰è¿æ¥ä¸Šå‘é€
âœ… å¤šä¸ªå“åº”å¯ä»¥åŒæ—¶è¿›è¡Œ (Cå’ŒDå¹¶è¡Œæ¥æ”¶)
âœ… æ— éœ€ç­‰å¾…å‰ä¸€ä¸ªè¯·æ±‚å®Œå…¨ç»“æŸ
```

### ğŸ’» æ—¶é—´é”™å¼€çš„å¤šè·¯å¤ç”¨ä»£ç æ¨¡æ‹Ÿ

```javascript
// æ—¶é—´é”™å¼€çš„HTTP/2å¤šè·¯å¤ç”¨åˆ†æå™¨
class TimeStaggeredHTTP2Analyzer {
  constructor() {
    this.connection = {
      established: false,
      establishTime: 0,
      activeStreams: new Map(),
      completedStreams: new Map()
    };
  }

  // æ¨¡æ‹Ÿæ—¶é—´é”™å¼€çš„è¯·æ±‚åœºæ™¯
  simulateTimeStaggeredRequests() {
    console.log('ğŸ• æ—¶é—´é”™å¼€çš„HTTP/2å¤šè·¯å¤ç”¨åœºæ™¯\n');
    
    const requests = [
      { time: 0.5, url: '/index.html', duration: 300, type: 'Document' },
      { time: 2.3, url: '/api/login', duration: 400, type: 'API' },      // è¯·æ±‚Aå®Œæˆå1.5sæ‰å‘èµ·
      { time: 4.1, url: '/images/photo.jpg', duration: 2100, type: 'Image' }, // åˆè¿‡äº†1.8s
      { time: 5.5, url: '/api/data', duration: 500, type: 'API' }       // å›¾ç‰‡è¿˜åœ¨ä¼ è¾“æ—¶å‘èµ·
    ];

    // å»ºç«‹è¿æ¥
    this.establishConnection(0);
    
    // å¤„ç†æ¯ä¸ªè¯·æ±‚
    requests.forEach((req, index) => {
      this.processRequest(index + 1, req);
    });
    
    this.analyzeMultiplexingBenefits(requests);
  }

  establishConnection(startTime) {
    this.connection.establishTime = startTime + 0.078; // 78mså»ºç«‹è¿æ¥
    this.connection.established = true;
    
    console.log('ğŸŒğŸ¤ HTTP/2è¿æ¥å»ºç«‹:');
    console.log(`   ${startTime}s â†’ ${this.connection.establishTime.toFixed(3)}s`);
    console.log('   DNS + TCP + TLSæ¡æ‰‹å®Œæˆï¼Œè¿æ¥å¯å¤ç”¨\n');
  }

  processRequest(streamId, request) {
    const requestStart = request.time;
    const responseStart = requestStart + 0.05; // 50msè¯·æ±‚ä¼ è¾“æ—¶é—´
    const responseEnd = requestStart + request.duration / 1000;
    
    // æ£€æŸ¥ä¸å…¶ä»–è¯·æ±‚çš„é‡å 
    const overlappingStreams = this.findOverlappingStreams(requestStart, responseEnd);
    
    console.log(`ğŸ“¤ Stream ${streamId} [${request.type}]: ${request.url}`);
    console.log(`   è¯·æ±‚æ—¶é—´: ${requestStart}s`);
    console.log(`   å“åº”æ—¶é—´: ${responseStart.toFixed(3)}s â†’ ${responseEnd.toFixed(3)}s`);
    
    if (overlappingStreams.length > 0) {
      console.log(`   ğŸš„ ä¸Stream ${overlappingStreams.join(', ')} å¹¶è¡Œä¼ è¾“`);
    } else {
      console.log(`   âš¡ ç‹¬å è¿æ¥ä¼ è¾“`);
    }
    
    this.connection.activeStreams.set(streamId, {
      ...request,
      requestStart,
      responseStart,
      responseEnd
    });
    
    console.log('');
  }

  findOverlappingStreams(newStart, newEnd) {
    const overlapping = [];
    
    this.connection.activeStreams.forEach((stream, streamId) => {
      // æ£€æŸ¥æ—¶é—´é‡å ï¼šæ–°è¯·æ±‚çš„å¼€å§‹æ—¶é—´ < ç°æœ‰è¯·æ±‚çš„ç»“æŸæ—¶é—´ ä¸” æ–°è¯·æ±‚çš„ç»“æŸæ—¶é—´ > ç°æœ‰è¯·æ±‚çš„å¼€å§‹æ—¶é—´
      if (newStart < stream.responseEnd && newEnd > stream.responseStart) {
        overlapping.push(streamId);
      }
    });
    
    return overlapping;
  }

  analyzeMultiplexingBenefits(requests) {
    console.log('ğŸ“Š æ—¶é—´é”™å¼€å¤šè·¯å¤ç”¨åˆ†æ:\n');
    
    // HTTP/1.1åœºæ™¯ï¼šæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦æ–°è¿æ¥
    const http1Scenario = this.calculateHTTP1Time(requests);
    
    // HTTP/2åœºæ™¯ï¼šå¤ç”¨åŒä¸€è¿æ¥
    const http2Scenario = this.calculateHTTP2Time(requests);
    
    console.log('ğŸ”„ HTTP/1.1 (æ¯ä¸ªè¯·æ±‚æ–°å»ºè¿æ¥):');
    http1Scenario.forEach((req, index) => {
      console.log(`   è¯·æ±‚${index + 1}: ${req.start.toFixed(1)}s â†’ ${req.end.toFixed(1)}s (å«è¿æ¥å»ºç«‹)`);
    });
    console.log(`   æ€»è€—æ—¶: ${Math.max(...http1Scenario.map(r => r.end)).toFixed(1)}s\n`);
    
    console.log('ğŸš„ HTTP/2 (å¤ç”¨åŒä¸€è¿æ¥):');
    console.log(`   è¿æ¥å»ºç«‹: 0.0s â†’ ${this.connection.establishTime.toFixed(3)}s (ä¸€æ¬¡æ€§)`);
    requests.forEach((req, index) => {
      const end = req.time + req.duration / 1000;
      console.log(`   è¯·æ±‚${index + 1}: ${req.time}s â†’ ${end.toFixed(1)}s (æ— è¿æ¥å¼€é”€)`);
    });
    const lastRequestEnd = Math.max(...requests.map(r => r.time + r.duration / 1000));
    console.log(`   æ€»è€—æ—¶: ${lastRequestEnd.toFixed(1)}s\n`);
    
    // è®¡ç®—èŠ‚çœçš„æ—¶é—´
    const http1Total = Math.max(...http1Scenario.map(r => r.end));
    const http2Total = lastRequestEnd;
    const timeSaved = http1Total - http2Total;
    const efficiency = (timeSaved / http1Total * 100).toFixed(1);
    
    console.log('âš¡ æ€§èƒ½å¯¹æ¯”:');
    console.log(`   HTTP/1.1æ€»è€—æ—¶: ${http1Total.toFixed(1)}s`);
    console.log(`   HTTP/2æ€»è€—æ—¶: ${http2Total.toFixed(1)}s`);
    console.log(`   èŠ‚çœæ—¶é—´: ${timeSaved.toFixed(1)}s`);
    console.log(`   æ•ˆç‡æå‡: ${efficiency}%`);
  }

  calculateHTTP1Time(requests) {
    return requests.map(req => {
      // æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦å»ºç«‹æ–°è¿æ¥
      const connectionTime = 0.078; // 78msè¿æ¥å»ºç«‹
      const start = req.time;
      const end = start + connectionTime + req.duration / 1000;
      return { start, end };
    });
  }

  calculateHTTP2Time(requests) {
    // HTTP/2åªéœ€è¦ä¸€æ¬¡è¿æ¥å»ºç«‹
    return requests.map(req => {
      const start = Math.max(req.time, this.connection.establishTime);
      const end = start + req.duration / 1000;
      return { start, end };
    });
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const staggeredAnalyzer = new TimeStaggeredHTTP2Analyzer();
staggeredAnalyzer.simulateTimeStaggeredRequests();

/* ç¤ºä¾‹è¾“å‡º:
ğŸ• æ—¶é—´é”™å¼€çš„HTTP/2å¤šè·¯å¤ç”¨åœºæ™¯

ğŸŒğŸ¤ HTTP/2è¿æ¥å»ºç«‹:
   0s â†’ 0.078s
   DNS + TCP + TLSæ¡æ‰‹å®Œæˆï¼Œè¿æ¥å¯å¤ç”¨

ğŸ“¤ Stream 1 [Document]: /index.html
   è¯·æ±‚æ—¶é—´: 0.5s
   å“åº”æ—¶é—´: 0.550s â†’ 0.800s
   âš¡ ç‹¬å è¿æ¥ä¼ è¾“

ğŸ“¤ Stream 2 [API]: /api/login
   è¯·æ±‚æ—¶é—´: 2.3s
   å“åº”æ—¶é—´: 2.350s â†’ 2.700s
   âš¡ ç‹¬å è¿æ¥ä¼ è¾“

ğŸ“¤ Stream 3 [Image]: /images/photo.jpg
   è¯·æ±‚æ—¶é—´: 4.1s
   å“åº”æ—¶é—´: 4.150s â†’ 6.200s
   âš¡ ç‹¬å è¿æ¥ä¼ è¾“

ğŸ“¤ Stream 4 [API]: /api/data
   è¯·æ±‚æ—¶é—´: 5.5s
   å“åº”æ—¶é—´: 5.550s â†’ 6.000s
   ğŸš„ ä¸Stream 3 å¹¶è¡Œä¼ è¾“

ğŸ“Š æ—¶é—´é”™å¼€å¤šè·¯å¤ç”¨åˆ†æ:

ğŸ”„ HTTP/1.1 (æ¯ä¸ªè¯·æ±‚æ–°å»ºè¿æ¥):
   è¯·æ±‚1: 0.5s â†’ 0.9s (å«è¿æ¥å»ºç«‹)
   è¯·æ±‚2: 2.3s â†’ 2.8s (å«è¿æ¥å»ºç«‹)
   è¯·æ±‚3: 4.1s â†’ 6.3s (å«è¿æ¥å»ºç«‹)
   è¯·æ±‚4: 5.5s â†’ 6.1s (å«è¿æ¥å»ºç«‹)
   æ€»è€—æ—¶: 6.3s

ğŸš„ HTTP/2 (å¤ç”¨åŒä¸€è¿æ¥):
   è¿æ¥å»ºç«‹: 0.0s â†’ 0.078s (ä¸€æ¬¡æ€§)
   è¯·æ±‚1: 0.5s â†’ 0.8s (æ— è¿æ¥å¼€é”€)
   è¯·æ±‚2: 2.3s â†’ 2.7s (æ— è¿æ¥å¼€é”€)
   è¯·æ±‚3: 4.1s â†’ 6.2s (æ— è¿æ¥å¼€é”€)
   è¯·æ±‚4: 5.5s â†’ 6.0s (æ— è¿æ¥å¼€é”€)
   æ€»è€—æ—¶: 6.2s

âš¡ æ€§èƒ½å¯¹æ¯”:
   HTTP/1.1æ€»è€—æ—¶: 6.3s
   HTTP/2æ€»è€—æ—¶: 6.2s
   èŠ‚çœæ—¶é—´: 0.1s
   æ•ˆç‡æå‡: 1.6%
*/
```

### ğŸ”‘ å…³é”®ç†è§£è¦ç‚¹

**âœ… HTTP/2å¤šè·¯å¤ç”¨çš„çœŸå®èƒ½åŠ›**ï¼š
1. **è¿æ¥æŒä¹…åŒ–**ï¼šä¸€æ—¦å»ºç«‹ï¼Œè¿æ¥ä¿æŒå¼€æ”¾çŠ¶æ€
2. **éšæ—¶å¯ç”¨**ï¼šä»»ä½•æ—¶å€™éƒ½å¯ä»¥åœ¨ç°æœ‰è¿æ¥ä¸Šå‘é€æ–°è¯·æ±‚
3. **çœŸæ­£å¹¶è¡Œ**ï¼šå¤šä¸ªå“åº”å¯ä»¥åŒæ—¶ä¼ è¾“ï¼Œäº’ä¸é˜»å¡
4. **æ— éœ€åŒæ—¶å‘èµ·**ï¼šè¯·æ±‚Aå®Œæˆå2ç§’å‘èµ·çš„è¯·æ±‚Bä¾ç„¶èƒ½å¤ç”¨è¿æ¥

**ğŸš„ å®é™…ä¼˜åŠ¿**ï¼š
- **æ¶ˆé™¤è¿æ¥å¼€é”€**ï¼šæ¯ä¸ªæ–°è¯·æ±‚èŠ‚çœ77.8msçš„è¿æ¥å»ºç«‹æ—¶é—´
- **å¹¶è¡Œå“åº”å¤„ç†**ï¼šå¦‚ç¤ºä¾‹ä¸­Stream 3å’Œ4å¯ä»¥åŒæ—¶æ¥æ”¶æ•°æ®
- **æ›´å¥½çš„èµ„æºåˆ©ç”¨**ï¼šä¸€ä¸ªTCPè¿æ¥å¤„ç†æ‰€æœ‰è¯·æ±‚

**ğŸ“Š æ€§èƒ½å¯¹æ¯”**ï¼š
- å³ä½¿åœ¨æ—¶é—´é”™å¼€çš„åœºæ™¯ä¸‹ï¼ŒHTTP/2ä¾ç„¶æ¯”HTTP/1.1æ›´é«˜æ•ˆ
- å½“è¯·æ±‚æœ‰æ—¶é—´é‡å æ—¶ï¼ˆå¦‚Stream 3å’Œ4ï¼‰ï¼Œä¼˜åŠ¿æ›´æ˜æ˜¾
- è¿æ¥å¤ç”¨å‡å°‘äº†æœåŠ¡å™¨çš„è¿æ¥æ•°å‹åŠ›

**ğŸ¯ å®é™…åº”ç”¨åœºæ™¯**ï¼š
- ç”¨æˆ·æµè§ˆç½‘é¡µæ—¶çš„å„ç§äº¤äº’
- å•é¡µåº”ç”¨çš„Ajaxè¯·æ±‚
- å›¾ç‰‡æ‡’åŠ è½½
- å®æ—¶æ•°æ®æ›´æ–°

æ‰€ä»¥å›ç­”æ‚¨çš„é—®é¢˜ï¼š**æ˜¯çš„ï¼Œå³ä½¿è¯·æ±‚Aå‘é€2ç§’åæ‰å‘é€è¯·æ±‚Bï¼ŒHTTP/2ä¾ç„¶èƒ½å¤Ÿå¤ç”¨åŒä¸€ä¸ªè¿æ¥ï¼Œè¿™å°±æ˜¯å®ƒçš„å¼ºå¤§ä¹‹å¤„ï¼** ğŸš€

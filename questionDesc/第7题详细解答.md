# 第7题详细解答：工程化规范（ESLint/Prettier/Husky）

> 题干：ESLint/Prettier/Husky 的配置和团队规范是如何制定的？（考察点：团队协作、代码规范制定、CI 守门）

## 面试者视角（怎么答）

### 1) 目标与原则
- 一致性优先：风格与排序交给 Prettier，逻辑与质量交给 ESLint；尽量少改默认、团队可共识。
- 最小干扰：本地快速反馈（pre-commit 只检查改动文件），重任务放 CI（全量 lint/type-check/test）。
- 可演进：规则分层（base/vue/ts/test），灰度发布规范变更；提供“自动修复优先”的落地手册。

### 2) 规范落地（工具链）
- ESLint：`eslint:recommended` + `plugin:vue/recommended` + `@typescript-eslint/recommended` + `plugin:prettier/recommended`；严控 `no-unused-vars`、`no-floating-promises`、`import/order`。
- Prettier：统一格式（printWidth、trailingComma、singleQuote 等），避免与 ESLint 冲突（以 Prettier 为准）。
- Husky + lint-staged：`pre-commit` 针对暂存文件跑 `eslint --fix` + `prettier --write`；`pre-push` 可跑单测（变化集或关键包）。
- Commit 规范：`commitlint` + Conventional Commits；配合 `semantic-release` 做自动版本与变更日志（可选）。
- CI 守门：PR 必过 `lint`、`type-check`、`test`、体积预算与 bundle 报告对比。

### 3) 团队规则与目录
- 代码目录与规则同构：`/src` 走严格规则，`/scripts` 放宽；测试文件允许 `devDependencies` import。
- 忽略策略：`.eslintignore`、`.prettierignore` 明确排除产物与锁文件；不允许在源码内到处写 `eslint-disable`，必要时限域。
- 推进方式：提供一键修复脚本与常见错误速查；周报公示违规前十与修复建议。

### 4) 小结（30s）
- “我们用 ESLint 管质量、Prettier 管风格、Husky+lint-staged 做本地守门、CI 做全量守门；规则分层并灰度升级，配合 commitlint 与可选的 semantic-release，保证规范可执行、成本可控、演进可持续。”

---

## 面试官视角（怎么问、看什么）

### 可追问清单（附考点）
- 为什么要引入 Prettier，与 ESLint 风格规则冲突如何解决？
  - 考点：`eslint-config-prettier`/`plugin:prettier/recommended`、风格 vs 质量职责划分。
- TypeScript 与 Vue 的规则如何取舍？
  - 考点：`@typescript-eslint` 与 `vue` 规则的优先级、`any` 管控、组件命名/props 排序/emit 类型化。
- pre-commit 与 CI 的职责边界？
  - 考点：改动集 vs 全量、运行时长预算、缓存与并行、失败门槛策略。
- commit 规范如何落地？
  - 考点：commit-msg hook、Conventional Commits、变更日志与版本策略（semantic-release）。
- 体积与性能守门？
  - 考点：bundle 报告、阈值报警、重复依赖去重、阻断合并策略。
- 单测与类型检查的接入？
  - 考点：`vue-tsc --noEmit`、`vitest/jest`、覆盖率阈值、快照更新流程。
- 规范变更如何灰度？
  - 考点：规则分层、子仓先行试点、changelog 与教育材料。

### 评估要点
- 是否做到“本地快、CI 严”；是否有示例配置与脚本；是否考虑团队协作（告警可读、自动修复优先）。

### 红旗信号
- 仅口头有规范、未自动化；pre-commit 过重影响开发；规则过严却无法自动修复。

---

## 代码与配置片段
```js
// .eslintrc.cjs
module.exports = {
  root: true,
  env: { browser: true, es2021: true, node: true },
  extends: [
    'eslint:recommended',
    'plugin:vue/recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:prettier/recommended'
  ],
  parser: 'vue-eslint-parser',
  parserOptions: {
    parser: '@typescript-eslint/parser',
    ecmaVersion: 'latest',
    sourceType: 'module'
  },
  rules: {
    'no-unused-vars': 'off',
    '@typescript-eslint/no-unused-vars': ['warn', { argsIgnorePattern: '^_', varsIgnorePattern: '^_' }],
    '@typescript-eslint/no-floating-promises': 'warn',
    'import/order': ['warn', { 'newlines-between': 'always', alphabetize: { order: 'asc' } }],
    'vue/multi-word-component-names': 'off'
  },
  overrides: [
    { files: ['*.spec.*','*.test.*'], rules: { '@typescript-eslint/no-explicit-any': 'off' } },
  ]
}
```
```json
// .prettierrc
{
  "printWidth": 100,
  "tabWidth": 2,
  "singleQuote": true,
  "semi": false,
  "trailingComma": "all",
  "arrowParens": "always"
}
```
```json
// package.json（节选）
{
  "scripts": {
    "lint": "eslint --ext .ts,.tsx,.js,.vue src",
    "lint:fix": "eslint --ext .ts,.tsx,.js,.vue src --fix",
    "format": "prettier --write .",
    "type-check": "vue-tsc --noEmit"
  },
  "lint-staged": {
    "*.{ts,tsx,js,vue,css,md}": [
      "eslint --fix",
      "prettier --write"
    ]
  }
}
```
```sh
# .husky/pre-commit
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged
```
```sh
# .husky/commit-msg
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx commitlint --edit "$1"
```

---

## 实战建议
- 先“能用”后“更严”：从 Prettier + 基础 ESLint 起步，再迭代引入更严格的 TS/Vue 规则。
- 规则分层与灰度发布：先在少数仓或目录试点，形成最佳实践再全仓启用。
- 给出“常见问题速查与一键修复脚本”，降低心理负担；CI 报错信息要可读。

## 常见坑
- ESLint 与 Prettier 冲突未解除；pre-commit 跑全量导致卡顿；忽略了 `vue-tsc` 类型守门。

## 总结
- 工程化规范的关键是“职责明确 + 自动化守门 + 团队可接受”：ESLint/Prettier/Husky/CI 形成闭环，并通过分层与灰度保证演进与落地效果。

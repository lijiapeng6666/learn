# 第20题详细解答：批量翻译流程（效率与质量）

> 题干：批量翻译脚本是如何工作的？如何保证翻译质量和效率？（考察点：自动化工具、缓存与校验、人工校对流程）

## 面试者视角（怎么答）

### 1) 流程总览
- Key 收集：扫描源代码与语言包，生成待翻译 key 列表（新/变更的 key）。
- 机器翻译：调用 MT（可对接自建/第三方），并带上下文（命名空间/注释）。
- 术语表与禁用词：在翻译前进行术语替换与禁用词过滤。
- 缓存与去重：按 `hash(ns+key+source)` 命中缓存，避免重复付费；分块并发。
- 人工校对：生成 PR，审阅与修订；敏感文本必须人工通过。
- 回写与发布：写入 `locales/xx/*.ts`，更新版本与变更日志；CI 运行校验。

### 2) 质量保障
- 术语库：科技术语/品牌词/大小写固定；按语言与国家区分。
- 规则校验：占位/变量对齐（{name}/%s/ICU 参数）、标点与空白、RTL 检查、长度上限。
- 对比与回归：同 key 历史对比；大幅变化需要人工审批。

### 3) 效率优化
- 批量/并发与速率限制；失败重试；增量翻译（只处理变更）。
- 本地预览：在 Dev Server 上即时加载翻译结果，快速验收。

### 4) 小结（30s）
- “脚本扫描并增量提取 key，走 MT + 术语表 + 缓存，生成 PR 由人工校对；发布前做占位与长度校验，保证质量与效率。”

---

## 面试官视角（怎么问、看什么）

### 可追问清单（附考点）
- Key 发现与增量策略？
  - 考点：静态扫描、白名单目录、hash 校验、与 Git 差异联动。
- MT 接入与上下文？
  - 考点：API/并发/速率、命名空间与注释、失败重试。
- 质量校验？
  - 考点：占位/变量、术语库、长度/RTL、人工审批节点。
- 缓存与成本？
  - 考点：hash 缓存、命中率、预算控制、重试与过期。

### 评估要点
- 是否有增量与缓存；是否有术语与规则校验；是否有人工闭环。

### 红旗信号
- 直接全量翻译；不校验占位；没有术语与人工校对。

---

## 代码与配置片段
```ts
// 扫描 key（示意，rg + 正则）
import { execSync } from 'node:child_process'
const out = execSync("rg -n " + `'\$t\([\"\']([\w\.:-]+)[\"\']'` + " src").toString()
```
```ts
// 缓存 key
interface CacheEntry { h: string; val: string; ts: number }
const cache = new Map<string, CacheEntry>()
```

---

## 实战建议
- 将术语库与禁用词独立仓库维护；每次翻译运行前加载。
- 生成“翻译变更报告”供产品/市场审阅；对高风险模块强制人工。

## 常见坑
- 占位错位导致运行时报错；翻译破坏品牌词；全量提交难审阅。

## 总结
- 批量翻译的关键是“增量化 + 缓存 + 术语与规则 + 人工审阅”，在效率与质量之间平衡。
